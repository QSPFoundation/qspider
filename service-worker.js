try{self["workbox:core:7.0.0"]&&_()}catch{}const logger=(()=>{"__WB_DISABLE_DEV_LOGS"in globalThis||(self.__WB_DISABLE_DEV_LOGS=!1);let f=!1;const u={debug:"#7f8c8d",log:"#2ecc71",warn:"#f39c12",error:"#c0392b",groupCollapsed:"#3498db",groupEnd:null},h=function(D,T){if(self.__WB_DISABLE_DEV_LOGS)return;if(D==="groupCollapsed"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){console[D](...T);return}const I=[`background: ${u[D]}`,"border-radius: 0.5em","color: white","font-weight: bold","padding: 2px 0.5em"],j=f?[]:["%cworkbox",I.join(";")];console[D](...j,...T),D==="groupCollapsed"&&(f=!0),D==="groupEnd"&&(f=!1)},m={},g=Object.keys(u);for(const D of g){const T=D;m[T]=(...I)=>{h(T,I)}}return m})(),messages$1={"invalid-value":({paramName:f,validValueDescription:u,value:h})=>{if(!f||!u)throw new Error("Unexpected input to 'invalid-value' error.");return`The '${f}' parameter was given a value with an unexpected value. ${u} Received a value of ${JSON.stringify(h)}.`},"not-an-array":({moduleName:f,className:u,funcName:h,paramName:m})=>{if(!f||!u||!h||!m)throw new Error("Unexpected input to 'not-an-array' error.");return`The parameter '${m}' passed into '${f}.${u}.${h}()' must be an array.`},"incorrect-type":({expectedType:f,paramName:u,moduleName:h,className:m,funcName:g})=>{if(!f||!u||!h||!g)throw new Error("Unexpected input to 'incorrect-type' error.");const D=m?`${m}.`:"";return`The parameter '${u}' passed into '${h}.${D}${g}()' must be of type ${f}.`},"incorrect-class":({expectedClassName:f,paramName:u,moduleName:h,className:m,funcName:g,isReturnValueProblem:D})=>{if(!f||!h||!g)throw new Error("Unexpected input to 'incorrect-class' error.");const T=m?`${m}.`:"";return D?`The return value from '${h}.${T}${g}()' must be an instance of class ${f}.`:`The parameter '${u}' passed into '${h}.${T}${g}()' must be an instance of class ${f}.`},"missing-a-method":({expectedMethod:f,paramName:u,moduleName:h,className:m,funcName:g})=>{if(!f||!u||!h||!m||!g)throw new Error("Unexpected input to 'missing-a-method' error.");return`${h}.${m}.${g}() expected the '${u}' parameter to expose a '${f}' method.`},"add-to-cache-list-unexpected-type":({entry:f})=>`An unexpected entry was passed to 'workbox-precaching.PrecacheController.addToCacheList()' The entry '${JSON.stringify(f)}' isn't supported. You must supply an array of strings with one or more characters, objects with a url property or Request objects.`,"add-to-cache-list-conflicting-entries":({firstEntry:f,secondEntry:u})=>{if(!f||!u)throw new Error("Unexpected input to 'add-to-cache-list-duplicate-entries' error.");return`Two of the entries passed to 'workbox-precaching.PrecacheController.addToCacheList()' had the URL ${f} but different revision details. Workbox is unable to cache and version the asset correctly. Please remove one of the entries.`},"plugin-error-request-will-fetch":({thrownErrorMessage:f})=>{if(!f)throw new Error("Unexpected input to 'plugin-error-request-will-fetch', error.");return`An error was thrown by a plugins 'requestWillFetch()' method. The thrown error message was: '${f}'.`},"invalid-cache-name":({cacheNameId:f,value:u})=>{if(!f)throw new Error("Expected a 'cacheNameId' for error 'invalid-cache-name'");return`You must provide a name containing at least one character for setCacheDetails({${f}: '...'}). Received a value of '${JSON.stringify(u)}'`},"unregister-route-but-not-found-with-method":({method:f})=>{if(!f)throw new Error("Unexpected input to 'unregister-route-but-not-found-with-method' error.");return`The route you're trying to unregister was not  previously registered for the method type '${f}'.`},"unregister-route-route-not-registered":()=>"The route you're trying to unregister was not previously registered.","queue-replay-failed":({name:f})=>`Replaying the background sync queue '${f}' failed.`,"duplicate-queue-name":({name:f})=>`The Queue name '${f}' is already being used. All instances of backgroundSync.Queue must be given unique names.`,"expired-test-without-max-age":({methodName:f,paramName:u})=>`The '${f}()' method can only be used when the '${u}' is used in the constructor.`,"unsupported-route-type":({moduleName:f,className:u,funcName:h,paramName:m})=>`The supplied '${m}' parameter was an unsupported type. Please check the docs for ${f}.${u}.${h} for valid input types.`,"not-array-of-class":({value:f,expectedClass:u,moduleName:h,className:m,funcName:g,paramName:D})=>`The supplied '${D}' parameter must be an array of '${u}' objects. Received '${JSON.stringify(f)},'. Please check the call to ${h}.${m}.${g}() to fix the issue.`,"max-entries-or-age-required":({moduleName:f,className:u,funcName:h})=>`You must define either config.maxEntries or config.maxAgeSecondsin ${f}.${u}.${h}`,"statuses-or-headers-required":({moduleName:f,className:u,funcName:h})=>`You must define either config.statuses or config.headersin ${f}.${u}.${h}`,"invalid-string":({moduleName:f,funcName:u,paramName:h})=>{if(!h||!f||!u)throw new Error("Unexpected input to 'invalid-string' error.");return`When using strings, the '${h}' parameter must start with 'http' (for cross-origin matches) or '/' (for same-origin matches). Please see the docs for ${f}.${u}() for more info.`},"channel-name-required":()=>"You must provide a channelName to construct a BroadcastCacheUpdate instance.","invalid-responses-are-same-args":()=>"The arguments passed into responsesAreSame() appear to be invalid. Please ensure valid Responses are used.","expire-custom-caches-only":()=>"You must provide a 'cacheName' property when using the expiration plugin with a runtime caching strategy.","unit-must-be-bytes":({normalizedRangeHeader:f})=>{if(!f)throw new Error("Unexpected input to 'unit-must-be-bytes' error.");return`The 'unit' portion of the Range header must be set to 'bytes'. The Range header provided was "${f}"`},"single-range-only":({normalizedRangeHeader:f})=>{if(!f)throw new Error("Unexpected input to 'single-range-only' error.");return`Multiple ranges are not supported. Please use a  single start value, and optional end value. The Range header provided was "${f}"`},"invalid-range-values":({normalizedRangeHeader:f})=>{if(!f)throw new Error("Unexpected input to 'invalid-range-values' error.");return`The Range header is missing both start and end values. At least one of those values is needed. The Range header provided was "${f}"`},"no-range-header":()=>"No Range header was found in the Request provided.","range-not-satisfiable":({size:f,start:u,end:h})=>`The start (${u}) and end (${h}) values in the Range are not satisfiable by the cached response, which is ${f} bytes.`,"attempt-to-cache-non-get-request":({url:f,method:u})=>`Unable to cache '${f}' because it is a '${u}' request and only 'GET' requests can be cached.`,"cache-put-with-no-response":({url:f})=>`There was an attempt to cache '${f}' but the response was not defined.`,"no-response":({url:f,error:u})=>{let h=`The strategy could not generate a response for '${f}'.`;return u&&(h+=` The underlying error is ${u}.`),h},"bad-precaching-response":({url:f,status:u})=>`The precaching request for '${f}' failed`+(u?` with an HTTP status of ${u}.`:"."),"non-precached-url":({url:f})=>`createHandlerBoundToURL('${f}') was called, but that URL is not precached. Please pass in a URL that is precached instead.`,"add-to-cache-list-conflicting-integrities":({url:f})=>`Two of the entries passed to 'workbox-precaching.PrecacheController.addToCacheList()' had the URL ${f} with different integrity values. Please remove one of them.`,"missing-precache-entry":({cacheName:f,url:u})=>`Unable to find a precached response in ${f} for ${u}.`,"cross-origin-copy-response":({origin:f})=>`workbox-core.copyResponse() can only be used with same-origin responses. It was passed a response with origin ${f}.`,"opaque-streams-source":({type:f})=>{const u=`One of the workbox-streams sources resulted in an '${f}' response.`;return f==="opaqueredirect"?`${u} Please do not use a navigation request that results in a redirect as a source.`:`${u} Please ensure your sources are CORS-enabled.`}},generatorFunction=(f,u={})=>{const h=messages$1[f];if(!h)throw new Error(`Unable to find message for code '${f}'.`);return h(u)},messageGenerator=generatorFunction;class WorkboxError extends Error{constructor(u,h){const m=messageGenerator(u,h);super(m),this.name=u,this.details=h}}const isArray=(f,u)=>{if(!Array.isArray(f))throw new WorkboxError("not-an-array",u)},hasMethod=(f,u,h)=>{if(typeof f[u]!=="function")throw h.expectedMethod=u,new WorkboxError("missing-a-method",h)},isType=(f,u,h)=>{if(typeof f!==u)throw h.expectedType=u,new WorkboxError("incorrect-type",h)},isInstance=(f,u,h)=>{if(!(f instanceof u))throw h.expectedClassName=u.name,new WorkboxError("incorrect-class",h)},isOneOf=(f,u,h)=>{if(!u.includes(f))throw h.validValueDescription=`Valid values are ${JSON.stringify(u)}.`,new WorkboxError("invalid-value",h)},isArrayOfClass=(f,u,h)=>{const m=new WorkboxError("not-array-of-class",h);if(!Array.isArray(f))throw m;for(const g of f)if(!(g instanceof u))throw m},finalAssertExports={hasMethod,isArray,isInstance,isOneOf,isType,isArrayOfClass},quotaErrorCallbacks=new Set,_cacheNameDetails={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:typeof registration<"u"?registration.scope:""},_createCacheName=f=>[_cacheNameDetails.prefix,f,_cacheNameDetails.suffix].filter(u=>u&&u.length>0).join("-"),eachCacheNameDetail=f=>{for(const u of Object.keys(_cacheNameDetails))f(u)},cacheNames={updateDetails:f=>{eachCacheNameDetail(u=>{typeof f[u]=="string"&&(_cacheNameDetails[u]=f[u])})},getGoogleAnalyticsName:f=>f||_createCacheName(_cacheNameDetails.googleAnalytics),getPrecacheName:f=>f||_createCacheName(_cacheNameDetails.precache),getPrefix:()=>_cacheNameDetails.prefix,getRuntimeName:f=>f||_createCacheName(_cacheNameDetails.runtime),getSuffix:()=>_cacheNameDetails.suffix};function stripParams(f,u){const h=new URL(f);for(const m of u)h.searchParams.delete(m);return h.href}async function cacheMatchIgnoreParams(f,u,h,m){const g=stripParams(u.url,h);if(u.url===g)return f.match(u,m);const D=Object.assign(Object.assign({},m),{ignoreSearch:!0}),T=await f.keys(u,D);for(const I of T){const j=stripParams(I.url,h);if(g===j)return f.match(I,m)}}class Deferred{constructor(){this.promise=new Promise((u,h)=>{this.resolve=u,this.reject=h})}}async function executeQuotaErrorCallbacks(){logger.log(`About to run ${quotaErrorCallbacks.size} callbacks to clean up caches.`);for(const f of quotaErrorCallbacks)await f(),logger.log(f,"is complete.");logger.log("Finished running callbacks.")}const getFriendlyURL=f=>new URL(String(f),location.href).href.replace(new RegExp(`^${location.origin}`),"");function timeout(f){return new Promise(u=>setTimeout(u,f))}function clientsClaim(){self.addEventListener("activate",()=>self.clients.claim())}const MIN_SIZE_ID="min-size-style",MAX_SIZE_ID="max-size-style";detectPlatform();function detectPlatform(){const f=navigator.userAgent;return f.includes("Windows")?"Windows":f.includes("Macintosh")?"Macintosh":f.includes("Linux")?"Linux":"Unknown"}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var dexie={exports:{}};(function(f,u){(function(h,m){f.exports=m()})(commonjsGlobal,function(){/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var h=function(e,t){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},h(e,t)};function m(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");h(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var g=function(){return g=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},g.apply(this,arguments)};function D(e,t,n){for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var T=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:commonjsGlobal,I=Object.keys,j=Array.isArray;typeof Promise<"u"&&!T.Promise&&(T.Promise=Promise);function Q(e,t){return typeof t!="object"||I(t).forEach(function(n){e[n]=t[n]}),e}var Z=Object.getPrototypeOf,te={}.hasOwnProperty;function H(e,t){return te.call(e,t)}function fe(e,t){typeof t=="function"&&(t=t(Z(e))),(typeof Reflect>"u"?I:Reflect.ownKeys)(t).forEach(function(n){ye(e,n,t[n])})}var Dn=Object.defineProperty;function ye(e,t,n,r){Dn(e,t,Q(n&&H(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function $e(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ye(e.prototype,"constructor",e),{extend:fe.bind(null,e.prototype)}}}}var Er=Object.getOwnPropertyDescriptor;function On(e,t){var n=Er(e,t),r;return n||(r=Z(e))&&On(r,t)}var Rr=[].slice;function lt(e,t,n){return Rr.call(e,t,n)}function Pn(e,t){return t(e)}function He(e){if(!e)throw new Error("Assertion Failed")}function Kn(e){T.setImmediate?setImmediate(e):setTimeout(e,0)}function kr(e,t){return e.reduce(function(n,r,i){var a=t(r,i);return a&&(n[a[0]]=a[1]),n},{})}function he(e,t){if(typeof t=="string"&&H(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var a=he(e,t[r]);n.push(a)}return n}var o=t.indexOf(".");if(o!==-1){var s=e[t.substr(0,o)];return s==null?void 0:he(s,t.substr(o+1))}}function ne(e,t,n){if(!(!e||t===void 0)&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){He(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)ne(e,t[r],n[r])}else{var a=t.indexOf(".");if(a!==-1){var o=t.substr(0,a),s=t.substr(a+1);if(s==="")n===void 0?j(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var c=e[o];(!c||!H(e,o))&&(c=e[o]={}),ne(c,s,n)}}else n===void 0?j(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Sr(e,t){typeof t=="string"?ne(e,t,void 0):"length"in t&&[].map.call(t,function(n){ne(e,n,void 0)})}function In(e){var t={};for(var n in e)H(e,n)&&(t[n]=e[n]);return t}var Cr=[].concat;function Mn(e){return Cr.apply([],e)}var Tr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Mn([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return T[e]}),Bn=new Set(Tr.map(function(e){return T[e]}));function $n(e){var t={};for(var n in e)if(H(e,n)){var r=e[n];t[n]=!r||typeof r!="object"||Bn.has(r.constructor)?r:$n(r)}return t}function Ar(e){for(var t in e)if(H(e,t))return!1;return!0}var Ge=null;function Ce(e){Ge=new WeakMap;var t=Ft(e);return Ge=null,t}function Ft(e){if(!e||typeof e!="object")return e;var t=Ge.get(e);if(t)return t;if(j(e)){t=[],Ge.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Ft(e[n]))}else if(Bn.has(e.constructor))t=e;else{var i=Z(e);t=i===Object.prototype?{}:Object.create(i),Ge.set(e,t);for(var a in e)H(e,a)&&(t[a]=Ft(e[a]))}return t}var Dr={}.toString;function Nt(e){return Dr.call(e).slice(8,-1)}var Lt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Or=typeof Lt=="symbol"?function(e){var t;return e!=null&&(t=e[Lt])&&t.apply(e)}:function(){return null};function Te(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var Fe={};function de(e){var t,n,r,i;if(arguments.length===1){if(j(e))return e.slice();if(this===Fe&&typeof e=="string")return[e];if(i=Or(e)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(e==null)return[e];if(t=e.length,typeof t=="number"){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var jt=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Pr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Fn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ut=Pr.concat(Fn),Kr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ne(e,t){this.name=e,this.message=t}$e(Ne).from(Error).extend({toString:function(){return this.name+": "+this.message}});function Nn(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function ft(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Nn(e,t)}$e(ft).from(Ne);function Le(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Nn(e,this.failures)}$e(Le).from(Ne);var Wt=Ut.reduce(function(e,t){return e[t]=t+"Error",e},{}),Ir=Ne,$=Ut.reduce(function(e,t){var n=t+"Error";function r(i,a){this.name=n,i?typeof i=="string"?(this.message="".concat(i).concat(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=Kr[t]||n,this.inner=null)}return $e(r).from(Ir),e[t]=r,e},{});$.Syntax=SyntaxError,$.Type=TypeError,$.Range=RangeError;var Ln=Fn.reduce(function(e,t){return e[t+"Error"]=$[t],e},{});function Mr(e,t){if(!e||e instanceof Ne||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Ln[e.name])return e;var n=new Ln[e.name](t||e.message,e);return"stack"in e&&ye(n,"stack",{get:function(){return this.inner.stack}}),n}var ht=Ut.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=$[t]),e},{});ht.ModifyError=ft,ht.DexieError=Ne,ht.BulkError=Le;function V(){}function Qe(e){return e}function Br(e,t){return e==null||e===Qe?t:function(n){return t(e(n))}}function Ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function $r(e,t){return e===V?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Ae(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Ae(i,this.onerror):i),a!==void 0?a:n}}function Fr(e,t){return e===V?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Ae(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Ae(r,this.onerror):r)}}function Nr(e,t){return e===V?t:function(n){var r=e.apply(this,arguments);Q(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ae(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Ae(a,this.onerror):a),r===void 0?o===void 0?void 0:o:Q(r,o)}}function Lr(e,t){return e===V?t:function(){return t.apply(this,arguments)===!1?!1:e.apply(this,arguments)}}function qt(e,t){return e===V?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}var se=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function jn(e,t){se=e}var Ye={},Un=100,Vt=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,Z(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Z(t),e]}(),Wn=Vt[0],qn=Vt[1],jr=Vt[2],Ur=qn&&qn.then,Xe=Wn&&Wn.constructor,zt=!!jr;function Wr(){queueMicrotask(Vr)}var Je=function(e,t){Ze.push([e,t]),dt&&(Wr(),dt=!1)},Ht=!0,dt=!0,De=[],pt=[],Gt=Qe,me={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:V,pgp:!1,env:{},finalize:V},B=me,Ze=[],Oe=0,vt=[];function O(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=B;if(typeof e!="function"){if(e!==Ye)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Yt(this,this._value);return}this._state=null,this._value=null,++t.ref,zn(this,e)}var Qt={get:function(){var e=B,t=wt;function n(r,i){var a=this,o=!e.global&&(e!==B||t!==wt),s=o&&!we(),c=new O(function(l,v){Xt(a,new Vn(Qn(r,e,o,s),Qn(i,e,o,s),l,v,e))});return this._consoleTask&&(c._consoleTask=this._consoleTask),c}return n.prototype=Ye,n},set:function(e){ye(this,"then",e&&e.prototype===Ye?Qt:{get:function(){return e},set:Qt.set})}};fe(O.prototype,{then:Qt,_then:function(e,t){Xt(this,new Vn(null,null,e,t,B))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return typeof t=="function"?this.then(null,function(r){return r instanceof t?n(r):yt(r)}):this.then(null,function(r){return r&&r.name===t?n(r):yt(r)})},finally:function(e){return this.then(function(t){return O.resolve(e()).then(function(){return t})},function(t){return O.resolve(e()).then(function(){return yt(t)})})},timeout:function(e,t){var n=this;return e<1/0?new O(function(r,i){var a=setTimeout(function(){return i(new $.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ye(O.prototype,Symbol.toStringTag,"Dexie.Promise"),me.env=Gn();function Vn(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}fe(O,{all:function(){var e=de.apply(null,arguments).map(bt);return new O(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return O.resolve(i).then(function(o){e[a]=o,--r||t(e)},n)})})},resolve:function(e){if(e instanceof O)return e;if(e&&typeof e.then=="function")return new O(function(n,r){e.then(n,r)});var t=new O(Ye,!0,e);return t},reject:yt,race:function(){var e=de.apply(null,arguments).map(bt);return new O(function(t,n){e.map(function(r){return O.resolve(r).then(t,n)})})},PSD:{get:function(){return B},set:function(e){return B=e}},totalEchoes:{get:function(){return wt}},newPSD:ge,usePSD:Pe,scheduler:{get:function(){return Je},set:function(e){Je=e}},rejectionMapper:{get:function(){return Gt},set:function(e){Gt=e}},follow:function(e,t){return new O(function(n,r){return ge(function(i,a){var o=B;o.unhandleds=[],o.onunhandled=a,o.finalize=Ae(function(){var s=this;zr(function(){s.unhandleds.length===0?i():a(s.unhandleds[0])})},o.finalize),e()},t,n,r)})}}),Xe&&(Xe.allSettled&&ye(O,"allSettled",function(){var e=de.apply(null,arguments).map(bt);return new O(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,a){return O.resolve(i).then(function(o){return r[a]={status:"fulfilled",value:o}},function(o){return r[a]={status:"rejected",reason:o}}).then(function(){return--n||t(r)})})})}),Xe.any&&typeof AggregateError<"u"&&ye(O,"any",function(){var e=de.apply(null,arguments).map(bt);return new O(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,o){return O.resolve(a).then(function(s){return t(s)},function(s){i[o]=s,--r||n(new AggregateError(i))})})})}));function zn(e,t){try{t(function(n){if(e._state===null){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&je();n&&typeof n.then=="function"?zn(e,function(i,a){n instanceof O?n._then(i,a):n.then(i,a)}):(e._state=!0,e._value=n,Hn(e)),r&&Ue()}},Yt.bind(null,e))}catch(n){Yt(e,n)}}function Yt(e,t){if(pt.push(t),e._state===null){var n=e._lib&&je();t=Gt(t),e._state=!1,e._value=t,Hr(e),Hn(e),n&&Ue()}}function Hn(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Xt(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),Oe===0&&(++Oe,Je(function(){--Oe===0&&Jt()},[]))}function Xt(e,t){if(e._state===null){e._listeners.push(t);return}var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Oe,Je(qr,[n,e,t])}function qr(e,t,n){try{var r,i=t._value;!t._state&&pt.length&&(pt=[]),r=se&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),!t._state&&pt.indexOf(i)===-1&&Gr(t),n.resolve(r)}catch(a){n.reject(a)}finally{--Oe===0&&Jt(),--n.psd.ref||n.psd.finalize()}}function Vr(){Pe(me,function(){je()&&Ue()})}function je(){var e=Ht;return Ht=!1,dt=!1,e}function Ue(){var e,t,n;do for(;Ze.length>0;)for(e=Ze,Ze=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(Ze.length>0);Ht=!0,dt=!0}function Jt(){var e=De;De=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=vt.slice(0),n=t.length;n;)t[--n]()}function zr(e){function t(){e(),vt.splice(vt.indexOf(t),1)}vt.push(t),++Oe,Je(function(){--Oe===0&&Jt()},[])}function Hr(e){De.some(function(t){return t._value===e._value})||De.push(e)}function Gr(e){for(var t=De.length;t;)if(De[--t]._value===e._value){De.splice(t,1);return}}function yt(e){return new O(Ye,!1,e)}function G(e,t){var n=B;return function(){var r=je(),i=B;try{return be(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{be(i,!1),r&&Ue()}}}var X={awaits:0,echoes:0,id:0},Qr=0,mt=[],gt=0,wt=0,Yr=0;function ge(e,t,n,r){var i=B,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++Yr,me.env,a.env=zt?{Promise:O,PromiseProp:{value:O,configurable:!0,writable:!0},all:O.all,race:O.race,allSettled:O.allSettled,any:O.any,resolve:O.resolve,reject:O.reject}:{},t&&Q(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Pe(a,e,n,r);return a.ref===0&&a.finalize(),o}function We(){return X.id||(X.id=++Qr),++X.awaits,X.echoes+=Un,X.id}function we(){return X.awaits?(--X.awaits===0&&(X.id=0),X.echoes=X.awaits*Un,!0):!1}(""+Ur).indexOf("[native code]")===-1&&(We=we=V);function bt(e){return X.echoes&&e&&e.constructor===Xe?(We(),e.then(function(t){return we(),t},function(t){return we(),Y(t)})):e}function Xr(e){++wt,(!X.echoes||--X.echoes===0)&&(X.echoes=X.awaits=X.id=0),mt.push(B),be(e,!0)}function Jr(){var e=mt[mt.length-1];mt.pop(),be(e,!1)}function be(e,t){var n=B;if((t?X.echoes&&(!gt++||e!==B):gt&&(!--gt||e!==B))&&queueMicrotask(t?Xr.bind(null,e):Jr),e!==B&&(B=e,n===me&&(me.env=Gn()),zt)){var r=me.env.Promise,i=e.env;(n.global||e.global)&&(Object.defineProperty(T,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Gn(){var e=T.Promise;return zt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(T,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Pe(e,t,n,r,i){var a=B;try{return be(e,!0),t(n,r,i)}finally{be(a,!1)}}function Qn(e,t,n,r){return typeof e!="function"?e:function(){var i=B;n&&We(),be(t,!0);try{return e.apply(this,arguments)}finally{be(i,!1),r&&queueMicrotask(we)}}}function Zt(e){Promise===Xe&&X.echoes===0?gt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}var Y=O.reject;function en(e,t,n,r){if(!e.idbdb||!e._state.openComplete&&!B.letThrough&&!e._vip){if(e._state.openComplete)return Y(new $.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return Y(new $.DatabaseClosed);e.open().catch(V)}return e._state.dbReadyPromise.then(function(){return en(e,t,n,r)})}else{var i=e._createTransaction(t,n,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(a){return a.name===Wt.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return en(e,t,n,r)})):Y(a)}return i._promise(t,function(a,o){return ge(function(){return B.trans=i,r(a,o,i)})}).then(function(a){if(t==="readwrite")try{i.idbtrans.commit()}catch{}return t==="readonly"?a:i._completion.then(function(){return a})})}}var Yn="4.0.8",Ke="￿",tn=-1/0,pe="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Xn="String expected.",qe=[],_t="__dbnames",nn="readonly",rn="readwrite";function Ie(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Jn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function xt(e){return typeof e=="string"&&!/\./.test(e)?function(t){return t[e]===void 0&&e in t&&(t=Ce(t),delete t[e]),t}:function(t){return t}}function Zn(){throw $.Type()}function q(e,t){try{var n=er(e),r=er(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return ei(tr(e),tr(t));case"Array":return Zr(e,t)}}catch{}return NaN}function Zr(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a){var o=q(e[a],t[a]);if(o!==0)return o}return n===r?0:n<r?-1:1}function ei(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a)if(e[a]!==t[a])return e[a]<t[a]?-1:1;return n===r?0:n<r?-1:1}function er(e){var t=typeof e;if(t!=="object")return t;if(ArrayBuffer.isView(e))return"binary";var n=Nt(e);return n==="ArrayBuffer"?"binary":n}function tr(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var nr=function(){function e(){}return e.prototype._trans=function(t,n,r){var i=this._tx||B.trans,a=this.name,o=se&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(t==="readonly"?"read":"write"," ").concat(this.name));function s(v,d,w){if(!w.schema[a])throw new $.NotFound("Table "+a+" not part of transaction");return n(w.idbtrans,w)}var c=je();try{var l=i&&i.db._novip===this.db._novip?i===B.trans?i._promise(t,s,r):ge(function(){return i._promise(t,s,r)},{trans:i,transless:B.transless||B}):en(this.db,t,[this.name],s);return o&&(l._consoleTask=o,l=l.catch(function(v){return console.trace(v),Y(v)})),l}finally{c&&Ue()}},e.prototype.get=function(t,n){var r=this;return t&&t.constructor===Object?this.where(t).first(n):t==null?Y(new $.Type("Invalid argument to Table.get()")):this._trans("readonly",function(i){return r.core.get({trans:i,key:t}).then(function(a){return r.hook.reading.fire(a)})}).then(n)},e.prototype.where=function(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(j(t))return new this.db.WhereClause(this,"[".concat(t.join("+"),"]"));var n=I(t);if(n.length===1)return this.where(n[0]).equals(t[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(d){if(d.compound&&n.every(function(C){return d.keyPath.indexOf(C)>=0})){for(var w=0;w<n.length;++w)if(n.indexOf(d.keyPath[w])===-1)return!1;return!0}return!1}).sort(function(d,w){return d.keyPath.length-w.keyPath.length})[0];if(r&&this.db._maxKey!==Ke){var i=r.keyPath.slice(0,n.length);return this.where(i).equals(i.map(function(d){return t[d]}))}!r&&se&&console.warn("The query ".concat(JSON.stringify(t)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(n.join("+"),"]"));var a=this.schema.idxByName,o=this.db._deps.indexedDB;function s(d,w){return o.cmp(d,w)===0}var c=n.reduce(function(d,w){var C=d[0],p=d[1],y=a[w],b=t[w];return[C||y,C||!y?Ie(p,y&&y.multi?function(x){var E=he(x,w);return j(E)&&E.some(function(k){return s(b,k)})}:function(x){return s(b,he(x,w))}):p]},[null,null]),l=c[0],v=c[1];return l?this.where(l.name).equals(t[l.keyPath]).filter(v):r?this.filter(v):this.where(n).equals("")},e.prototype.filter=function(t){return this.toCollection().and(t)},e.prototype.count=function(t){return this.toCollection().count(t)},e.prototype.offset=function(t){return this.toCollection().offset(t)},e.prototype.limit=function(t){return this.toCollection().limit(t)},e.prototype.each=function(t){return this.toCollection().each(t)},e.prototype.toArray=function(t){return this.toCollection().toArray(t)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,j(t)?"[".concat(t.join("+"),"]"):t))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(t){var n=this,r=n.db,i=n.name;this.schema.mappedClass=t,t.prototype instanceof Zn&&(t=function(c){m(l,c);function l(){return c!==null&&c.apply(this,arguments)||this}return Object.defineProperty(l.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),l.prototype.table=function(){return i},l}(t));for(var a=new Set,o=t.prototype;o;o=Z(o))Object.getOwnPropertyNames(o).forEach(function(c){return a.add(c)});var s=function(c){if(!c)return c;var l=Object.create(t.prototype);for(var v in c)if(!a.has(v))try{l[v]=c[v]}catch{}return l};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=s,this.hook("reading",s),t},e.prototype.defineClass=function(){function t(n){Q(this,n)}return this.mapToClass(t)},e.prototype.add=function(t,n){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,s=t;return o&&a&&(s=xt(o)(t)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"add",keys:n!=null?[n]:null,values:[s]})}).then(function(c){return c.numFailures?O.reject(c.failures[0]):c.lastResult}).then(function(c){if(o)try{ne(t,o,c)}catch{}return c})},e.prototype.update=function(t,n){if(typeof t=="object"&&!j(t)){var r=he(t,this.schema.primKey.keyPath);return r===void 0?Y(new $.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(t).modify(n)},e.prototype.put=function(t,n){var r=this,i=this.schema.primKey,a=i.auto,o=i.keyPath,s=t;return o&&a&&(s=xt(o)(t)),this._trans("readwrite",function(c){return r.core.mutate({trans:c,type:"put",values:[s],keys:n!=null?[n]:null})}).then(function(c){return c.numFailures?O.reject(c.failures[0]):c.lastResult}).then(function(c){if(o)try{ne(t,o,c)}catch{}return c})},e.prototype.delete=function(t){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[t]})}).then(function(r){return r.numFailures?O.reject(r.failures[0]):void 0})},e.prototype.clear=function(){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"deleteRange",range:Jn})}).then(function(n){return n.numFailures?O.reject(n.failures[0]):void 0})},e.prototype.bulkGet=function(t){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:t,trans:r}).then(function(i){return i.map(function(a){return n.hook.reading.fire(a)})})})},e.prototype.bulkAdd=function(t,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var c=i.schema.primKey,l=c.auto,v=c.keyPath;if(v&&a)throw new $.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");var d=t.length,w=v&&l?t.map(xt(v)):t;return i.core.mutate({trans:s,type:"add",keys:a,values:w,wantResults:o}).then(function(C){var p=C.numFailures,y=C.results,b=C.lastResult,x=C.failures,E=o?y:b;if(p===0)return E;throw new Le("".concat(i.name,".bulkAdd(): ").concat(p," of ").concat(d," operations failed"),x)})})},e.prototype.bulkPut=function(t,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var o=r?r.allKeys:void 0;return this._trans("readwrite",function(s){var c=i.schema.primKey,l=c.auto,v=c.keyPath;if(v&&a)throw new $.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==t.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");var d=t.length,w=v&&l?t.map(xt(v)):t;return i.core.mutate({trans:s,type:"put",keys:a,values:w,wantResults:o}).then(function(C){var p=C.numFailures,y=C.results,b=C.lastResult,x=C.failures,E=o?y:b;if(p===0)return E;throw new Le("".concat(i.name,".bulkPut(): ").concat(p," of ").concat(d," operations failed"),x)})})},e.prototype.bulkUpdate=function(t){var n=this,r=this.core,i=t.map(function(s){return s.key}),a=t.map(function(s){return s.changes}),o=[];return this._trans("readwrite",function(s){return r.getMany({trans:s,keys:i,cache:"clone"}).then(function(c){var l=[],v=[];t.forEach(function(w,C){var p=w.key,y=w.changes,b=c[C];if(b){for(var x=0,E=Object.keys(y);x<E.length;x++){var k=E[x],S=y[k];if(k===n.schema.primKey.keyPath){if(q(S,p)!==0)throw new $.Constraint("Cannot update primary key in bulkUpdate()")}else ne(b,k,S)}o.push(C),l.push(p),v.push(b)}});var d=l.length;return r.mutate({trans:s,type:"put",keys:l,values:v,updates:{keys:i,changeSpecs:a}}).then(function(w){var C=w.numFailures,p=w.failures;if(C===0)return d;for(var y=0,b=Object.keys(p);y<b.length;y++){var x=b[y],E=o[Number(x)];if(E!=null){var k=p[x];delete p[x],p[E]=k}}throw new Le("".concat(n.name,".bulkUpdate(): ").concat(C," of ").concat(d," operations failed"),p)})})})},e.prototype.bulkDelete=function(t){var n=this,r=t.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:t})}).then(function(i){var a=i.numFailures,o=i.lastResult,s=i.failures;if(a===0)return o;throw new Le("".concat(n.name,".bulkDelete(): ").concat(a," of ").concat(r," operations failed"),s)})},e}();function et(e){var t={},n=function(s,c){if(c){for(var l=arguments.length,v=new Array(l-1);--l;)v[l-1]=arguments[l];return t[s].subscribe.apply(null,v),e}else if(typeof s=="string")return t[s]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(s,c,l){if(typeof s=="object")return o(s);c||(c=Lr),l||(l=V);var v={subscribers:[],fire:l,subscribe:function(d){v.subscribers.indexOf(d)===-1&&(v.subscribers.push(d),v.fire=c(v.fire,d))},unsubscribe:function(d){v.subscribers=v.subscribers.filter(function(w){return w!==d}),v.fire=v.subscribers.reduce(c,l)}};return t[s]=n[s]=v,v}function o(s){I(s).forEach(function(c){var l=s[c];if(j(l))a(c,s[c][0],s[c][1]);else if(l==="asap")var v=a(c,Qe,function(){for(var w=arguments.length,C=new Array(w);w--;)C[w]=arguments[w];v.subscribers.forEach(function(p){Kn(function(){p.apply(null,C)})})});else throw new $.InvalidArgument("Invalid event config")})}}function tt(e,t){return $e(t).from({prototype:e}),t}function ti(e){return tt(nr.prototype,function(n,r,i){this.db=e,this._tx=i,this.name=n,this.schema=r,this.hook=e._allTables[n]?e._allTables[n].hook:et(null,{creating:[$r,V],reading:[Br,Qe],updating:[Nr,V],deleting:[Fr,V]})})}function Ve(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function an(e,t){e.filter=Ie(e.filter,t)}function on(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ie(r(),t())}:t,e.justLimit=n&&!r}function ni(e,t){e.isMatch=Ie(e.isMatch,t)}function Et(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new $.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function rr(e,t,n){var r=Et(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function Rt(e,t,n,r){var i=e.replayFilter?Ie(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(s,c,l){if(!i||i(c,l,function(w){return c.stop(w)},function(w){return c.fail(w)})){var v=c.primaryKey,d=""+v;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(v)),H(a,d)||(a[d]=!0,t(s,c,l))}};return Promise.all([e.or._iterate(o,n),ir(rr(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}else return ir(rr(e,r,n),Ie(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function ir(e,t,n,r){var i=r?function(o,s,c){return n(r(o),s,c)}:n,a=G(i);return e.then(function(o){if(o)return o.start(function(){var s=function(){return o.continue()};(!t||t(o,function(c){return s=c},function(c){o.stop(c),s=V},function(c){o.fail(c),s=V}))&&a(o.value,o,function(c){return s=c}),s()})})}var ri=Symbol(),nt=function(){function e(t){Object.assign(this,t)}return e.prototype.execute=function(t){var n;if(this.add!==void 0){var r=this.add;if(j(r))return D(D([],j(t)?t:[],!0),r).sort();if(typeof r=="number")return(Number(t)||0)+r;if(typeof r=="bigint")try{return BigInt(t)+r}catch{return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(this.remove!==void 0){var i=this.remove;if(j(i))return j(t)?t.filter(function(o){return!i.includes(o)}).sort():[];if(typeof i=="number")return Number(t)-i;if(typeof i=="bigint")try{return BigInt(t)-i}catch{return BigInt(0)-i}throw new TypeError("Invalid subtrahend ".concat(i))}var a=(n=this.replacePrefix)===null||n===void 0?void 0:n[0];return a&&typeof t=="string"&&t.startsWith(a)?this.replacePrefix[1]+t.substring(a.length):t},e}(),ii=function(){function e(){}return e.prototype._read=function(t,n){var r=this._ctx;return r.error?r.table._trans(null,Y.bind(null,r.error)):r.table._trans("readonly",t).then(n)},e.prototype._write=function(t){var n=this._ctx;return n.error?n.table._trans(null,Y.bind(null,n.error)):n.table._trans("readwrite",t,"locked")},e.prototype._addAlgorithm=function(t){var n=this._ctx;n.algorithm=Ie(n.algorithm,t)},e.prototype._iterate=function(t,n){return Rt(this._ctx,t,n,this._ctx.table.core)},e.prototype.clone=function(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&Q(r,t),n._ctx=r,n},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(t){var n=this._ctx;return this._read(function(r){return Rt(n,t,r,n.table.core)})},e.prototype.count=function(t){var n=this;return this._read(function(r){var i=n._ctx,a=i.table.core;if(Ve(i,!0))return a.count({trans:r,query:{index:Et(i,a.schema),range:i.range}}).then(function(s){return Math.min(s,i.limit)});var o=0;return Rt(i,function(){return++o,!1},r,a).then(function(){return o})}).then(t)},e.prototype.sortBy=function(t,n){var r=t.split(".").reverse(),i=r[0],a=r.length-1;function o(l,v){return v?o(l[r[v]],v-1):l[i]}var s=this._ctx.dir==="next"?1:-1;function c(l,v){var d=o(l,a),w=o(v,a);return d<w?-s:d>w?s:0}return this.toArray(function(l){return l.sort(c)}).then(n)},e.prototype.toArray=function(t){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&Ve(i,!0)&&i.limit>0){var a=i.valueMapper,o=Et(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:o,range:i.range}}).then(function(c){var l=c.result;return a?l.map(a):l})}else{var s=[];return Rt(i,function(c){return s.push(c)},r,i.table.core).then(function(){return s})}},t)},e.prototype.offset=function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,Ve(n)?on(n,function(){var r=t;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):on(n,function(){var r=t;return function(){return--r<0}}),this)},e.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),on(this._ctx,function(){var n=t;return function(r,i,a){return--n<=0&&i(a),n>=0}},!0),this},e.prototype.until=function(t,n){return an(this._ctx,function(r,i,a){return t(r.value)?(i(a),n):!0}),this},e.prototype.first=function(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)},e.prototype.last=function(t){return this.reverse().first(t)},e.prototype.filter=function(t){return an(this._ctx,function(n){return t(n.value)}),ni(this._ctx,t),this},e.prototype.and=function(t){return this.filter(t)},e.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},e.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.key,i)})},e.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},e.prototype.eachPrimaryKey=function(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){t(i.primaryKey,i)})},e.prototype.keys=function(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(t)},e.prototype.primaryKeys=function(t){var n=this._ctx;if(n.dir==="next"&&Ve(n,!0)&&n.limit>0)return this._read(function(i){var a=Et(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(i){var a=i.result;return a}).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(t)},e.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},e.prototype.firstKey=function(t){return this.limit(1).keys(function(n){return n[0]}).then(t)},e.prototype.lastKey=function(t){return this.reverse().firstKey(t)},e.prototype.distinct=function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return an(this._ctx,function(i){var a=i.primaryKey.toString(),o=H(r,a);return r[a]=!0,!o}),this},e.prototype.modify=function(t){var n=this,r=this._ctx;return this._write(function(i){var a;if(typeof t=="function")a=t;else{var o=I(t),s=o.length;a=function(x){for(var E=!1,k=0;k<s;++k){var S=o[k],R=t[S],A=he(x,S);R instanceof nt?(ne(x,S,R.execute(A)),E=!0):A!==R&&(ne(x,S,R),E=!0)}return E}}var c=r.table.core,l=c.schema.primaryKey,v=l.outbound,d=l.extractKey,w=n.db._options.modifyChunkSize||200,C=[],p=0,y=[],b=function(x,E){var k=E.failures,S=E.numFailures;p+=x-S;for(var R=0,A=I(k);R<A.length;R++){var P=A[R];C.push(k[P])}};return n.clone().primaryKeys().then(function(x){var E=Ve(r)&&r.limit===1/0&&(typeof t!="function"||t===sn)&&{index:r.index,range:r.range},k=function(S){var R=Math.min(w,x.length-S);return c.getMany({trans:i,keys:x.slice(S,S+R),cache:"immutable"}).then(function(A){for(var P=[],K=[],L=v?[]:null,M=[],F=0;F<R;++F){var W=A[F],U={value:Ce(W),primKey:x[S+F]};a.call(U,U.value,U)!==!1&&(U.value==null?M.push(x[S+F]):!v&&q(d(W),d(U.value))!==0?(M.push(x[S+F]),P.push(U.value)):(K.push(U.value),v&&L.push(x[S+F])))}return Promise.resolve(P.length>0&&c.mutate({trans:i,type:"add",values:P}).then(function(z){for(var N in z.failures)M.splice(parseInt(N),1);b(P.length,z)})).then(function(){return(K.length>0||E&&typeof t=="object")&&c.mutate({trans:i,type:"put",keys:L,values:K,criteria:E,changeSpec:typeof t!="function"&&t,isAdditionalChunk:S>0}).then(function(z){return b(K.length,z)})}).then(function(){return(M.length>0||E&&t===sn)&&c.mutate({trans:i,type:"delete",keys:M,criteria:E,isAdditionalChunk:S>0}).then(function(z){return b(M.length,z)})}).then(function(){return x.length>S+R&&k(S+w)})})};return k(0).then(function(){if(C.length>0)throw new ft("Error modifying one or more objects",C,p,y);return x.length})})})},e.prototype.delete=function(){var t=this._ctx,n=t.range;return Ve(t)&&(t.isPrimKey||n.type===3)?this._write(function(r){var i=t.table.core.schema.primaryKey,a=n;return t.table.core.count({trans:r,query:{index:i,range:a}}).then(function(o){return t.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(s){var c=s.failures;s.lastResult,s.results;var l=s.numFailures;if(l)throw new ft("Could not delete some values",Object.keys(c).map(function(v){return c[v]}),o-l);return o-l})})}):this.modify(sn)},e}(),sn=function(e,t){return t.value=null};function ai(e){return tt(ii.prototype,function(n,r){this.db=e;var i=Jn,a=null;if(r)try{i=r()}catch(l){a=l}var o=n._ctx,s=o.table,c=s.hook.reading.fire;this._ctx={table:s,index:o.index,isPrimKey:!o.index||s.schema.primKey.keyPath&&o.index===s.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:o.or,valueMapper:c!==Qe?c:null}})}function oi(e,t){return e<t?-1:e===t?0:1}function si(e,t){return e>t?-1:e===t?0:1}function re(e,t,n){var r=e instanceof or?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function ze(e){return new e.Collection(e,function(){return ar("")}).limit(0)}function ui(e){return e==="next"?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}function ci(e){return e==="next"?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}function li(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,c=0;c<o;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],l)<0&&(s=c)}return o<r.length&&a==="next"?e+n.substr(e.length):o<e.length&&a==="prev"?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function kt(e,t,n,r){var i,a,o,s,c,l,v,d=n.length;if(!n.every(function(y){return typeof y=="string"}))return re(e,Xn);function w(y){i=ui(y),a=ci(y),o=y==="next"?oi:si;var b=n.map(function(x){return{lower:a(x),upper:i(x)}}).sort(function(x,E){return o(x.lower,E.lower)});s=b.map(function(x){return x.upper}),c=b.map(function(x){return x.lower}),l=y,v=y==="next"?"":r}w("next");var C=new e.Collection(e,function(){return _e(s[0],c[d-1]+r)});C._ondirectionchange=function(y){w(y)};var p=0;return C._addAlgorithm(function(y,b,x){var E=y.key;if(typeof E!="string")return!1;var k=a(E);if(t(k,c,p))return!0;for(var S=null,R=p;R<d;++R){var A=li(E,k,s[R],c[R],o,l);A===null&&S===null?p=R+1:(S===null||o(S,A)>0)&&(S=A)}return b(S!==null?function(){y.continue(S+v)}:x),!1}),C}function _e(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ar(e){return{type:1,lower:e,upper:e}}var or=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(t,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(t,n)>0||this._cmp(t,n)===0&&(r||i)&&!(r&&i)?ze(this):new this.Collection(this,function(){return _e(t,n,!r,!i)})}catch{return re(this,pe)}},e.prototype.equals=function(t){return t==null?re(this,pe):new this.Collection(this,function(){return ar(t)})},e.prototype.above=function(t){return t==null?re(this,pe):new this.Collection(this,function(){return _e(t,void 0,!0)})},e.prototype.aboveOrEqual=function(t){return t==null?re(this,pe):new this.Collection(this,function(){return _e(t,void 0,!1)})},e.prototype.below=function(t){return t==null?re(this,pe):new this.Collection(this,function(){return _e(void 0,t,!1,!0)})},e.prototype.belowOrEqual=function(t){return t==null?re(this,pe):new this.Collection(this,function(){return _e(void 0,t)})},e.prototype.startsWith=function(t){return typeof t!="string"?re(this,Xn):this.between(t,t+Ke,!0,!0)},e.prototype.startsWithIgnoreCase=function(t){return t===""?this.startsWith(t):kt(this,function(n,r){return n.indexOf(r[0])===0},[t],Ke)},e.prototype.equalsIgnoreCase=function(t){return kt(this,function(n,r){return n===r[0]},[t],"")},e.prototype.anyOfIgnoreCase=function(){var t=de.apply(Fe,arguments);return t.length===0?ze(this):kt(this,function(n,r){return r.indexOf(n)!==-1},t,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var t=de.apply(Fe,arguments);return t.length===0?ze(this):kt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},t,Ke)},e.prototype.anyOf=function(){var t=this,n=de.apply(Fe,arguments),r=this._cmp;try{n.sort(r)}catch{return re(this,pe)}if(n.length===0)return ze(this);var i=new this.Collection(this,function(){return _e(n[0],n[n.length-1])});i._ondirectionchange=function(o){r=o==="next"?t._ascending:t._descending,n.sort(r)};var a=0;return i._addAlgorithm(function(o,s,c){for(var l=o.key;r(l,n[a])>0;)if(++a,a===n.length)return s(c),!1;return r(l,n[a])===0?!0:(s(function(){o.continue(n[a])}),!1)}),i},e.prototype.notEqual=function(t){return this.inAnyRange([[tn,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var t=de.apply(Fe,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return re(this,pe)}var n=t.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[tn,i]]},null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(t,n){var r=this,i=this._cmp,a=this._ascending,o=this._descending,s=this._min,c=this._max;if(t.length===0)return ze(this);if(!t.every(function(R){return R[0]!==void 0&&R[1]!==void 0&&a(R[0],R[1])<=0}))return re(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",$.InvalidArgument);var l=!n||n.includeLowers!==!1,v=n&&n.includeUppers===!0;function d(R,A){for(var P=0,K=R.length;P<K;++P){var L=R[P];if(i(A[0],L[1])<0&&i(A[1],L[0])>0){L[0]=s(L[0],A[0]),L[1]=c(L[1],A[1]);break}}return P===K&&R.push(A),R}var w=a;function C(R,A){return w(R[0],A[0])}var p;try{p=t.reduce(d,[]),p.sort(C)}catch{return re(this,pe)}var y=0,b=v?function(R){return a(R,p[y][1])>0}:function(R){return a(R,p[y][1])>=0},x=l?function(R){return o(R,p[y][0])>0}:function(R){return o(R,p[y][0])>=0};function E(R){return!b(R)&&!x(R)}var k=b,S=new this.Collection(this,function(){return _e(p[0][0],p[p.length-1][1],!l,!v)});return S._ondirectionchange=function(R){R==="next"?(k=b,w=a):(k=x,w=o),p.sort(C)},S._addAlgorithm(function(R,A,P){for(var K=R.key;k(K);)if(++y,y===p.length)return A(P),!1;return E(K)?!0:(r._cmp(K,p[y][1])===0||r._cmp(K,p[y][0])===0||A(function(){w===a?R.continue(p[y][0]):R.continue(p[y][1])}),!1)}),S},e.prototype.startsWithAnyOf=function(){var t=de.apply(Fe,arguments);return t.every(function(n){return typeof n=="string"})?t.length===0?ze(this):this.inAnyRange(t.map(function(n){return[n,n+Ke]})):re(this,"startsWithAnyOf() only works with strings")},e}();function fi(e){return tt(or.prototype,function(n,r,i){if(this.db=e,this._ctx={table:n,index:r===":id"?null:r,or:i},this._cmp=this._ascending=q,this._descending=function(a,o){return q(o,a)},this._max=function(a,o){return q(a,o)>0?a:o},this._min=function(a,o){return q(a,o)<0?a:o},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new $.MissingAPI})}function ue(e){return G(function(t){return rt(t),e(t.target.error),!1})}function rt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var it="storagemutated",un="x-storagemutated-1",xe=et(null,it),hi=function(){function e(){}return e.prototype._lock=function(){return He(!B.global),++this._reculock,this._reculock===1&&!B.global&&(B.lockOwnerFor=this),this},e.prototype._unlock=function(){if(He(!B.global),--this._reculock===0)for(B.global||(B.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Pe(t[1],t[0])}catch{}}return this},e.prototype._locked=function(){return this._reculock&&B.lockOwnerFor!==this},e.prototype.create=function(t){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(He(!this.idbtrans),!t&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new $.DatabaseClosed(i);case"MissingAPIError":throw new $.MissingAPI(i.message,i);default:throw new $.OpenFailed(i)}if(!this.active)throw new $.TransactionInactive;return He(this._completion._state===null),t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),t.onerror=G(function(a){rt(a),n._reject(t.error)}),t.onabort=G(function(a){rt(a),n.active&&n._reject(new $.Abort(t.error)),n.active=!1,n.on("abort").fire(a)}),t.oncomplete=G(function(){n.active=!1,n._resolve(),"mutatedParts"in t&&xe.storagemutated.fire(t.mutatedParts)}),this},e.prototype._promise=function(t,n,r){var i=this;if(t==="readwrite"&&this.mode!=="readwrite")return Y(new $.ReadOnly("Transaction is readonly"));if(!this.active)return Y(new $.TransactionInactive);if(this._locked())return new O(function(o,s){i._blockedFuncs.push([function(){i._promise(t,n,r).then(o,s)},B])});if(r)return ge(function(){var o=new O(function(s,c){i._lock();var l=n(s,c,i);l&&l.then&&l.then(s,c)});return o.finally(function(){return i._unlock()}),o._lib=!0,o});var a=new O(function(o,s){var c=n(o,s,i);c&&c.then&&c.then(o,s)});return a._lib=!0,a},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(t){var n=this._root(),r=O.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var a=n._waitingFor;return new O(function(o,s){r.then(function(c){return n._waitingQueue.push(G(o.bind(null,c)))},function(c){return n._waitingQueue.push(G(s.bind(null,c)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new $.Abort))},e.prototype.table=function(t){var n=this._memoizedTables||(this._memoizedTables={});if(H(n,t))return n[t];var r=this.schema[t];if(!r)throw new $.NotFound("Table "+t+" not part of transaction");var i=new this.db.Table(t,r,this);return i.core=this.db.core.table(t),n[t]=i,i},e}();function di(e){return tt(hi.prototype,function(n,r,i,a,o){var s=this;this.db=e,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=et(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new O(function(c,l){s._resolve=c,s._reject=l}),this._completion.then(function(){s.active=!1,s.on.complete.fire()},function(c){var l=s.active;return s.active=!1,s.on.error.fire(c),s.parent?s.parent._reject(c):l&&s.idbtrans&&s.idbtrans.abort(),Y(c)})})}function cn(e,t,n,r,i,a,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+sr(t)}}function sr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ln(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:kr(n,function(r){return[r.name,r]})}}function pi(e){return e.length===1?e[0]:e}var at=function(e){try{return e.only([[]]),at=function(){return[[]]},[[]]}catch{return at=function(){return Ke},Ke}};function fn(e){return e==null?function(){}:typeof e=="string"?vi(e):function(t){return he(t,e)}}function vi(e){var t=e.split(".");return t.length===1?function(n){return n[e]}:function(n){return he(n,e)}}function ur(e){return[].slice.call(e)}var yi=0;function ot(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function mi(e,t,n){function r(d,w){var C=ur(d.objectStoreNames);return{schema:{name:d.name,tables:C.map(function(p){return w.objectStore(p)}).map(function(p){var y=p.keyPath,b=p.autoIncrement,x=j(y),E=y==null,k={},S={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:E,compound:x,keyPath:y,autoIncrement:b,unique:!0,extractKey:fn(y)},indexes:ur(p.indexNames).map(function(R){return p.index(R)}).map(function(R){var A=R.name,P=R.unique,K=R.multiEntry,L=R.keyPath,M=j(L),F={name:A,compound:M,keyPath:L,unique:P,multiEntry:K,extractKey:fn(L)};return k[ot(L)]=F,F}),getIndexByKeyPath:function(R){return k[ot(R)]}};return k[":id"]=S.primaryKey,y!=null&&(k[ot(y)]=S.primaryKey),S})},hasGetAll:C.length>0&&"getAll"in w.objectStore(C[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(d){if(d.type===3)return null;if(d.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var w=d.lower,C=d.upper,p=d.lowerOpen,y=d.upperOpen,b=w===void 0?C===void 0?null:t.upperBound(C,!!y):C===void 0?t.lowerBound(w,!!p):t.bound(w,C,!!p,!!y);return b}function a(d){var w=d.name;function C(b){var x=b.trans,E=b.type,k=b.keys,S=b.values,R=b.range;return new Promise(function(A,P){A=G(A);var K=x.objectStore(w),L=K.keyPath==null,M=E==="put"||E==="add";if(!M&&E!=="delete"&&E!=="deleteRange")throw new Error("Invalid operation type: "+E);var F=(k||S||{length:1}).length;if(k&&S&&k.length!==S.length)throw new Error("Given keys array must have same length as given values array.");if(F===0)return A({numFailures:0,failures:{},results:[],lastResult:void 0});var W,U=[],z=[],N=0,J=function(le){++N,rt(le)};if(E==="deleteRange"){if(R.type===4)return A({numFailures:N,failures:z,results:[],lastResult:void 0});R.type===3?U.push(W=K.clear()):U.push(W=K.delete(i(R)))}else{var ae=M?L?[S,k]:[S,null]:[k,null],ke=ae[0],ce=ae[1];if(M)for(var ie=0;ie<F;++ie)U.push(W=ce&&ce[ie]!==void 0?K[E](ke[ie],ce[ie]):K[E](ke[ie])),W.onerror=J;else for(var ie=0;ie<F;++ie)U.push(W=K[E](ke[ie])),W.onerror=J}var Se=function(le){var ct=le.target.result;U.forEach(function(oe,$t){return oe.error!=null&&(z[$t]=oe.error)}),A({numFailures:N,failures:z,results:E==="delete"?k:U.map(function(oe){return oe.result}),lastResult:ct})};W.onerror=function(le){J(le),Se(le)},W.onsuccess=Se})}function p(b){var x=b.trans,E=b.values,k=b.query,S=b.reverse,R=b.unique;return new Promise(function(A,P){A=G(A);var K=k.index,L=k.range,M=x.objectStore(w),F=K.isPrimaryKey?M:M.index(K.name),W=S?R?"prevunique":"prev":R?"nextunique":"next",U=E||!("openKeyCursor"in F)?F.openCursor(i(L),W):F.openKeyCursor(i(L),W);U.onerror=ue(P),U.onsuccess=G(function(z){var N=U.result;if(!N){A(null);return}N.___id=++yi,N.done=!1;var J=N.continue.bind(N),ae=N.continuePrimaryKey;ae&&(ae=ae.bind(N));var ke=N.advance.bind(N),ce=function(){throw new Error("Cursor not started")},ie=function(){throw new Error("Cursor not stopped")};N.trans=x,N.stop=N.continue=N.continuePrimaryKey=N.advance=ce,N.fail=G(P),N.next=function(){var Se=this,le=1;return this.start(function(){return le--?Se.continue():Se.stop()}).then(function(){return Se})},N.start=function(Se){var le=new Promise(function(oe,$t){oe=G(oe),U.onerror=ue($t),N.fail=$t,N.stop=function(ia){N.stop=N.continue=N.continuePrimaryKey=N.advance=ie,oe(ia)}}),ct=function(){if(U.result)try{Se()}catch(oe){N.fail(oe)}else N.done=!0,N.start=function(){throw new Error("Cursor behind last entry")},N.stop()};return U.onsuccess=G(function(oe){U.onsuccess=ct,ct()}),N.continue=J,N.continuePrimaryKey=ae,N.advance=ke,ct(),le},A(N)},P)})}function y(b){return function(x){return new Promise(function(E,k){E=G(E);var S=x.trans,R=x.values,A=x.limit,P=x.query,K=A===1/0?void 0:A,L=P.index,M=P.range,F=S.objectStore(w),W=L.isPrimaryKey?F:F.index(L.name),U=i(M);if(A===0)return E({result:[]});if(b){var z=R?W.getAll(U,K):W.getAllKeys(U,K);z.onsuccess=function(ke){return E({result:ke.target.result})},z.onerror=ue(k)}else{var N=0,J=R||!("openKeyCursor"in W)?W.openCursor(U):W.openKeyCursor(U),ae=[];J.onsuccess=function(ke){var ce=J.result;if(!ce)return E({result:ae});if(ae.push(R?ce.value:ce.primaryKey),++N===A)return E({result:ae});ce.continue()},J.onerror=ue(k)}})}}return{name:w,schema:d,mutate:C,getMany:function(b){var x=b.trans,E=b.keys;return new Promise(function(k,S){k=G(k);for(var R=x.objectStore(w),A=E.length,P=new Array(A),K=0,L=0,M,F=function(N){var J=N.target;(P[J._pos]=J.result)!=null,++L===K&&k(P)},W=ue(S),U=0;U<A;++U){var z=E[U];z!=null&&(M=R.get(E[U]),M._pos=U,M.onsuccess=F,M.onerror=W,++K)}K===0&&k(P)})},get:function(b){var x=b.trans,E=b.key;return new Promise(function(k,S){k=G(k);var R=x.objectStore(w),A=R.get(E);A.onsuccess=function(P){return k(P.target.result)},A.onerror=ue(S)})},query:y(c),openCursor:p,count:function(b){var x=b.query,E=b.trans,k=x.index,S=x.range;return new Promise(function(R,A){var P=E.objectStore(w),K=k.isPrimaryKey?P:P.index(k.name),L=i(S),M=L?K.count(L):K.count();M.onsuccess=G(function(F){return R(F.target.result)}),M.onerror=ue(A)})}}}var o=r(e,n),s=o.schema,c=o.hasGetAll,l=s.tables.map(function(d){return a(d)}),v={};return l.forEach(function(d){return v[d.name]=d}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(d){var w=v[d];if(!w)throw new Error("Table '".concat(d,"' not found"));return v[d]},MIN_KEY:-1/0,MAX_KEY:at(t),schema:s}}function gi(e,t){return t.reduce(function(n,r){var i=r.create;return g(g({},n),i(n))},e)}function wi(e,t,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=gi(mi(t,i,r),e.dbcore);return{dbcore:a}}function St(e,t){var n=t.db,r=wi(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach(function(i){var a=i.name;e.core.schema.tables.some(function(o){return o.name===a})&&(i.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=i.core))})}function Ct(e,t,n,r){n.forEach(function(i){var a=r[i];t.forEach(function(o){var s=On(o,i);(!s||"value"in s&&s.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?ye(o,i,{get:function(){return this.table(i)},set:function(c){Dn(this,i,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new e.Table(i,a))})})}function hn(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function bi(e,t){return e._cfg.version-t._cfg.version}function _i(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=ln("$meta",lr("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var o=a._reject.bind(a),s=B.transless||B;ge(function(){if(B.trans=a,B.transless=s,t===0)I(i).forEach(function(c){pn(n,c,i[c].primKey,i[c].indexes)}),St(e,n),O.follow(function(){return e.on.populate.fire(a)}).catch(o);else return St(e,n),Ei(e,a,t).then(function(c){return Ri(e,c,a,n)}).catch(o)})}function xi(e,t){cr(e._dbSchema,t),t.db.version%10===0&&!t.objectStoreNames.contains("$meta")&&t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=At(e,e.idbdb,t);Dt(e,e._dbSchema,t);for(var r=dn(n,e._dbSchema),i=function(l){if(l.change.length||l.recreate)return console.warn("Unable to patch indexes of table ".concat(l.name," because it has changes on the type of index or primary key.")),{value:void 0};var v=t.objectStore(l.name);l.add.forEach(function(d){se&&console.debug("Dexie upgrade patch: Creating missing index ".concat(l.name,".").concat(d.src)),Tt(v,d)})},a=0,o=r.change;a<o.length;a++){var s=o[a],c=i(s);if(typeof c=="object")return c.value}}function Ei(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then(function(r){return r??n}):O.resolve(n)}function Ri(e,t,n,r){var i=[],a=e._versions,o=e._dbSchema=At(e,e.idbdb,r),s=a.filter(function(l){return l._cfg.version>=t});if(s.length===0)return O.resolve();s.forEach(function(l){i.push(function(){var v=o,d=l._cfg.dbschema;Dt(e,v,r),Dt(e,d,r),o=e._dbSchema=d;var w=dn(v,d);w.add.forEach(function(E){pn(r,E[0],E[1].primKey,E[1].indexes)}),w.change.forEach(function(E){if(E.recreate)throw new $.Upgrade("Not yet support for changing primary key");var k=r.objectStore(E.name);E.add.forEach(function(S){return Tt(k,S)}),E.change.forEach(function(S){k.deleteIndex(S.name),Tt(k,S)}),E.del.forEach(function(S){return k.deleteIndex(S)})});var C=l._cfg.contentUpgrade;if(C&&l._cfg.version>t){St(e,r),n._memoizedTables={};var p=In(d);w.del.forEach(function(E){p[E]=v[E]}),hn(e,[e.Transaction.prototype]),Ct(e,[e.Transaction.prototype],I(p),p),n.schema=p;var y=jt(C);y&&We();var b,x=O.follow(function(){if(b=C(n),b&&y){var E=we.bind(null,null);b.then(E,E)}});return b&&typeof b.then=="function"?O.resolve(b):x.then(function(){return b})}}),i.push(function(v){var d=l._cfg.dbschema;ki(d,v),hn(e,[e.Transaction.prototype]),Ct(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema}),i.push(function(v){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===l._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter(function(d){return d!=="$meta"})):v.objectStore("$meta").put(l._cfg.version,"version"))})});function c(){return i.length?O.resolve(i.shift()(n.idbtrans)).then(c):O.resolve()}return c().then(function(){cr(o,r)})}function dn(e,t){var n={del:[],add:[],change:[]},r;for(r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],a=t[r];if(!i)n.add.push([r,a]);else{var o={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto)o.recreate=!0,n.change.push(o);else{var s=i.idxByName,c=a.idxByName,l=void 0;for(l in s)c[l]||o.del.push(l);for(l in c){var v=s[l],d=c[l];v?v.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}}return n}function pn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return Tt(i,a)}),i}function cr(e,t){I(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(se&&console.debug("Dexie: Creating missing table",n),pn(t,n,e[n].primKey,e[n].indexes))})}function ki(e,t){[].slice.call(t.db.objectStoreNames).forEach(function(n){return e[n]==null&&t.db.deleteObjectStore(n)})}function Tt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function At(e,t,n){var r={},i=lt(t.objectStoreNames,0);return i.forEach(function(a){for(var o=n.objectStore(a),s=o.keyPath,c=cn(sr(s),s||"",!0,!1,!!o.autoIncrement,s&&typeof s!="string",!0),l=[],v=0;v<o.indexNames.length;++v){var d=o.index(o.indexNames[v]);s=d.keyPath;var w=cn(d.name,s,!!d.unique,!!d.multiEntry,!1,s&&typeof s!="string",!1);l.push(w)}r[a]=ln(a,c,l)}),r}function Si(e,t,n){e.verno=t.version/10;var r=e._dbSchema=At(e,t,n);e._storeNames=lt(t.objectStoreNames,0),Ct(e,[e._allTables],I(r),r)}function Ci(e,t){var n=At(e,e.idbdb,t),r=dn(n,e._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function Dt(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],o=n.objectStore(a);e._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var c=o.indexNames[s],l=o.index(c).keyPath,v=typeof l=="string"?l:"["+lt(l).join("+")+"]";if(t[a]){var d=t[a].idxByName[v];d&&(d.name=c,delete t[a].idxByName[v],t[a].idxByName[c]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&T.WorkerGlobalScope&&T instanceof T.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function lr(e){return e.split(",").map(function(t,n){t=t.trim();var r=t.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return cn(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),j(i),n===0)})}var Ti=function(){function e(){}return e.prototype._parseStoresSpec=function(t,n){I(t).forEach(function(r){if(t[r]!==null){var i=lr(t[r]),a=i.shift();if(a.unique=!0,a.multi)throw new $.Schema("Primary key cannot be multi-valued");i.forEach(function(o){if(o.auto)throw new $.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new $.Schema("Index must have a name and cannot be an empty string")}),n[r]=ln(r,a,i)}})},e.prototype.stores=function(t){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?Q(this._cfg.storesSource,t):t;var r=n._versions,i={},a={};return r.forEach(function(o){Q(i,o._cfg.storesSource),a=o._cfg.dbschema={},o._parseStoresSpec(i,a)}),n._dbSchema=a,hn(n,[n._allTables,n,n.Transaction.prototype]),Ct(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],I(a),a),n._storeNames=I(a),this},e.prototype.upgrade=function(t){return this._cfg.contentUpgrade=qt(this._cfg.contentUpgrade||V,t),this},e}();function Ai(e){return tt(Ti.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function vn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new ve(_t,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function yn(e){return e&&typeof e.databases=="function"}function Di(e){var t=e.indexedDB,n=e.IDBKeyRange;return yn(t)?Promise.resolve(t.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==_t})}):vn(t,n).toCollection().primaryKeys()}function Oi(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!yn(n)&&t!==_t&&vn(n,r).put({name:t}).catch(V)}function Pi(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!yn(n)&&t!==_t&&vn(n,r).delete(t).catch(V)}function mn(e){return ge(function(){return B.letThrough=!0,e()})}function Ki(){var e=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!e||!indexedDB.databases)return Promise.resolve();var t;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)})}var gn;function wn(e){return!("from"in e)}var ee=function(e,t){if(this)Q(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0});else{var n=new ee;return e&&"d"in e&&Q(n,e),n}};fe(ee.prototype,(gn={add:function(e){return ut(this,e),this},addKey:function(e){return st(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return st(t,n,n)}),this},hasKey:function(e){var t=Ot(this).next(e).value;return t&&q(t.from,e)<=0&&q(t.to,e)>=0}},gn[Lt]=function(){return Ot(this)},gn));function st(e,t,n){var r=q(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(wn(e))return Q(e,{from:t,to:n,d:1});var i=e.l,a=e.r;if(q(n,e.from)<0)return i?st(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},hr(e);if(q(t,e.to)>0)return a?st(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},hr(e);q(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),q(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var o=!e.r;i&&!e.l&&ut(e,i),a&&o&&ut(e,a)}}function ut(e,t){function n(r,i){var a=i.from,o=i.to,s=i.l,c=i.r;st(r,a,o),s&&n(r,s),c&&n(r,c)}wn(t)||n(e,t)}function fr(e,t){var n=Ot(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=Ot(e),o=a.next(i.from),s=o.value;!r.done&&!o.done;){if(q(s.from,i.to)<=0&&q(s.to,i.from)>=0)return!0;q(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(o=a.next(i.from)).value}return!1}function Ot(e){var t=wn(e)?null:{s:0,n:e};return{next:function(n){for(var r=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&q(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||q(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function hr(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",o=g({},e),s=e[i];e.from=s.from,e.to=s.to,e[i]=s[i],o[i]=s[a],e[a]=o,o.d=dr(o)}e.d=dr(e)}function dr(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function Pt(e,t){return I(t).forEach(function(n){e[n]?ut(e[n],t[n]):e[n]=$n(t[n])}),e}function bn(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&fr(t[n],e[n])})}var Me={},_n={},xn=!1;function Kt(e,t){Pt(_n,e),xn||(xn=!0,setTimeout(function(){xn=!1;var n=_n;_n={},En(n,!1)},0))}function En(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(Me);r<i.length;r++){var a=i[r];pr(a,e,n,t)}else for(var o in e){var s=/^idb\:\/\/(.*)\/(.*)\//.exec(o);if(s){var c=s[1],l=s[2],a=Me["idb://".concat(c,"/").concat(l)];a&&pr(a,e,n,t)}}n.forEach(function(v){return v()})}function pr(e,t,n,r){for(var i=[],a=0,o=Object.entries(e.queries.query);a<o.length;a++){for(var s=o[a],c=s[0],l=s[1],v=[],d=0,w=l;d<w.length;d++){var C=w[d];bn(t,C.obsSet)?C.subscribers.forEach(function(x){return n.add(x)}):r&&v.push(C)}r&&i.push([c,v])}if(r)for(var p=0,y=i;p<y.length;p++){var b=y[p],c=b[0],v=b[1];e.queries.query[c]=v}}function Ii(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Y(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(e.verno*10),a=!1;function o(){if(t.openCanceller!==r)throw new $.DatabaseClosed("db.open() was cancelled")}var s=t.dbReadyResolve,c=null,l=!1,v=function(){return new O(function(d,w){if(o(),!n)throw new $.MissingAPI;var C=e.name,p=t.autoSchema||!i?n.open(C):n.open(C,i);if(!p)throw new $.MissingAPI;p.onerror=ue(w),p.onblocked=G(e._fireOnBlocked),p.onupgradeneeded=G(function(y){if(c=p.transaction,t.autoSchema&&!e._options.allowEmptyDB){p.onerror=rt,c.abort(),p.result.close();var b=n.deleteDatabase(C);b.onsuccess=b.onerror=G(function(){w(new $.NoSuchDatabase("Database ".concat(C," doesnt exist")))})}else{c.onerror=ue(w);var x=y.oldVersion>Math.pow(2,62)?0:y.oldVersion;l=x<1,e.idbdb=p.result,a&&xi(e,c),_i(e,x/10,c,w)}},w),p.onsuccess=G(function(){c=null;var y=e.idbdb=p.result,b=lt(y.objectStoreNames);if(b.length>0)try{var x=y.transaction(pi(b),"readonly");if(t.autoSchema)Si(e,y,x);else if(Dt(e,e._dbSchema,x),!Ci(e,x)&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),y.close(),i=y.version+1,a=!0,d(v());St(e,x)}catch{}qe.push(e),y.onversionchange=G(function(E){t.vcFired=!0,e.on("versionchange").fire(E)}),y.onclose=G(function(E){e.on("close").fire(E)}),l&&Oi(e._deps,C),d()},w)}).catch(function(d){switch(d==null?void 0:d.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),v();break;case"VersionError":if(i>0)return i=0,v();break}return O.reject(d)})};return O.race([r,(typeof navigator>"u"?O.resolve():Ki()).then(v)]).then(function(){return o(),t.onReadyBeingFired=[],O.resolve(mn(function(){return e.on.ready.fire(e.vip)})).then(function d(){if(t.onReadyBeingFired.length>0){var w=t.onReadyBeingFired.reduce(qt,V);return t.onReadyBeingFired=[],O.resolve(mn(function(){return w(e.vip)})).then(d)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(d){t.dbOpenError=d;try{c&&c.abort()}catch{}return r===t.openCanceller&&e._close(),Y(d)}).finally(function(){t.openComplete=!0,s()}).then(function(){if(l){var d={};e.tables.forEach(function(w){w.schema.indexes.forEach(function(C){C.name&&(d["idb://".concat(e.name,"/").concat(w.name,"/").concat(C.name)]=new ee(-1/0,[[[]]]))}),d["idb://".concat(e.name,"/").concat(w.name,"/")]=d["idb://".concat(e.name,"/").concat(w.name,"/:dels")]=new ee(-1/0,[[[]]])}),xe(it).fire(d),En(d,!0)}return e})}function Rn(e){var t=function(o){return e.next(o)},n=function(o){return e.throw(o)},r=a(t),i=a(n);function a(o){return function(s){var c=o(s),l=c.value;return c.done?l:!l||typeof l.then!="function"?j(l)?Promise.all(l).then(r,i):r(l):l.then(r,i)}}return a(t)()}function Mi(e,t,n){var r=arguments.length;if(r<2)throw new $.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=Mn(i);return[e,a,n]}function vr(e,t,n,r,i){return O.resolve().then(function(){var a=B.transless||B,o=e._createTransaction(t,n,e._dbSchema,r);o.explicit=!0;var s={trans:o,transless:a};if(r)o.idbtrans=r.idbtrans;else try{o.create(),o.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(d){return d.name===Wt.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then(function(){return vr(e,t,n,null,i)})):Y(d)}var c=jt(i);c&&We();var l,v=O.follow(function(){if(l=i.call(o,o),l)if(c){var d=we.bind(null,null);l.then(d,d)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=Rn(l))},s);return(l&&typeof l.then=="function"?O.resolve(l).then(function(d){return o.active?d:Y(new $.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):v.then(function(){return l})).then(function(d){return r&&o._resolve(),o._completion.then(function(){return d})}).catch(function(d){return o._reject(d),Y(d)})})}function It(e,t,n){for(var r=j(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}function Bi(e){return g(g({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function o(y,b,x){var E=ot(y),k=i[E]=i[E]||[],S=y==null?0:typeof y=="string"?1:y.length,R=b>0,A=g(g({},x),{name:R?"".concat(E,"(virtual-from:").concat(x.name,")"):x.name,lowLevelIndex:x,isVirtual:R,keyTail:b,keyLength:S,extractKey:fn(y),unique:!R&&x.unique});if(k.push(A),A.isPrimaryKey||a.push(A),S>1){var P=S===2?y[0]:y.slice(0,S-1);o(P,b+1,x)}return k.sort(function(K,L){return K.keyTail-L.keyTail}),A}var s=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[s];for(var c=0,l=r.indexes;c<l.length;c++){var v=l[c];o(v.keyPath,0,v)}function d(y){var b=i[ot(y)];return b&&b[0]}function w(y,b){return{type:y.type===1?2:y.type,lower:It(y.lower,y.lowerOpen?e.MAX_KEY:e.MIN_KEY,b),lowerOpen:!0,upper:It(y.upper,y.upperOpen?e.MIN_KEY:e.MAX_KEY,b),upperOpen:!0}}function C(y){var b=y.query.index;return b.isVirtual?g(g({},y),{query:{index:b.lowLevelIndex,range:w(y.query.range,b.keyTail)}}):y}var p=g(g({},n),{schema:g(g({},r),{primaryKey:s,indexes:a,getIndexByKeyPath:d}),count:function(y){return n.count(C(y))},query:function(y){return n.query(C(y))},openCursor:function(y){var b=y.query.index,x=b.keyTail,E=b.isVirtual,k=b.keyLength;if(!E)return n.openCursor(y);function S(R){function A(K){K!=null?R.continue(It(K,y.reverse?e.MAX_KEY:e.MIN_KEY,x)):y.unique?R.continue(R.key.slice(0,k).concat(y.reverse?e.MIN_KEY:e.MAX_KEY,x)):R.continue()}var P=Object.create(R,{continue:{value:A},continuePrimaryKey:{value:function(K,L){R.continuePrimaryKey(It(K,e.MAX_KEY,x),L)}},primaryKey:{get:function(){return R.primaryKey}},key:{get:function(){var K=R.key;return k===1?K[0]:K.slice(0,k)}},value:{get:function(){return R.value}}});return P}return n.openCursor(C(y)).then(function(R){return R&&S(R)})}});return p}})}var $i={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Bi};function kn(e,t,n,r){return n=n||{},r=r||"",I(e).forEach(function(i){if(!H(t,i))n[r+i]=void 0;else{var a=e[i],o=t[i];if(typeof a=="object"&&typeof o=="object"&&a&&o){var s=Nt(a),c=Nt(o);s!==c?n[r+i]=t[i]:s==="Object"?kn(a,o,n,r+i+"."):a!==o&&(n[r+i]=t[i])}else a!==o&&(n[r+i]=t[i])}}),I(t).forEach(function(i){H(e,i)||(n[r+i]=t[i])}),n}function Sn(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Fi={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return g(g({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey,i=g(g({},n),{mutate:function(a){var o=B.trans,s=o.table(t).hook,c=s.deleting,l=s.creating,v=s.updating;switch(a.type){case"add":if(l.fire===V)break;return o._promise("readwrite",function(){return d(a)},!0);case"put":if(l.fire===V&&v.fire===V)break;return o._promise("readwrite",function(){return d(a)},!0);case"delete":if(c.fire===V)break;return o._promise("readwrite",function(){return d(a)},!0);case"deleteRange":if(c.fire===V)break;return o._promise("readwrite",function(){return w(a)},!0)}return n.mutate(a);function d(p){var y=B.trans,b=p.keys||Sn(r,p);if(!b)throw new Error("Keys missing");return p=p.type==="add"||p.type==="put"?g(g({},p),{keys:b}):g({},p),p.type!=="delete"&&(p.values=D([],p.values)),p.keys&&(p.keys=D([],p.keys)),Ni(n,p,b).then(function(x){var E=b.map(function(k,S){var R=x[S],A={onerror:null,onsuccess:null};if(p.type==="delete")c.fire.call(A,k,R,y);else if(p.type==="add"||R===void 0){var P=l.fire.call(A,k,p.values[S],y);k==null&&P!=null&&(k=P,p.keys[S]=k,r.outbound||ne(p.values[S],r.keyPath,k))}else{var K=kn(R,p.values[S]),L=v.fire.call(A,K,k,R,y);if(L){var M=p.values[S];Object.keys(L).forEach(function(F){H(M,F)?M[F]=L[F]:ne(M,F,L[F])})}}return A});return n.mutate(p).then(function(k){for(var S=k.failures,R=k.results,A=k.numFailures,P=k.lastResult,K=0;K<b.length;++K){var L=R?R[K]:b[K],M=E[K];L==null?M.onerror&&M.onerror(S[K]):M.onsuccess&&M.onsuccess(p.type==="put"&&x[K]?p.values[K]:L)}return{failures:S,results:R,numFailures:A,lastResult:P}}).catch(function(k){return E.forEach(function(S){return S.onerror&&S.onerror(k)}),Promise.reject(k)})})}function w(p){return C(p.trans,p.range,1e4)}function C(p,y,b){return n.query({trans:p,values:!1,query:{index:r,range:y},limit:b}).then(function(x){var E=x.result;return d({type:"delete",keys:E,trans:p}).then(function(k){return k.numFailures>0?Promise.reject(k.failures[0]):E.length<b?{failures:[],numFailures:0,lastResult:void 0}:C(p,g(g({},y),{lower:E[E.length-1],lowerOpen:!0}),b)})})}}});return i}})}};function Ni(e,t,n){return t.type==="add"?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}function yr(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)q(t.keys[i],e[a])===0&&(r.push(n?Ce(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Li={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return g(g({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=yr(r.keys,r.trans._cache,r.cache==="clone");return i?O.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Ce(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function mr(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function gr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}var ji={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new ee(e.MIN_KEY,e.MAX_KEY);return g(g({},e),{transaction:function(r,i,a){if(B.subscr&&i!=="readonly")throw new $.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(B.querier));return e.transaction(r,i,a)},table:function(r){var i=e.table(r),a=i.schema,o=a.primaryKey,s=a.indexes,c=o.extractKey,l=o.outbound,v=o.autoIncrement&&s.filter(function(p){return p.compound&&p.keyPath.includes(o.keyPath)}),d=g(g({},i),{mutate:function(p){var y=p.trans,b=p.mutatedParts||(p.mutatedParts={}),x=function(F){var W="idb://".concat(t,"/").concat(r,"/").concat(F);return b[W]||(b[W]=new ee)},E=x(""),k=x(":dels"),S=p.type,R=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[Sn(o,p).filter(function(F){return F}),p.values]:[],A=R[0],P=R[1],K=p.trans._cache;if(j(A)){E.addKeys(A);var L=S==="delete"||A.length===P.length?yr(A,K):null;L||k.addKeys(A),(L||P)&&Ui(x,a,L,P)}else if(A){var M={from:A.lower,to:A.upper};k.add(M),E.add(M)}else E.add(n),k.add(n),a.indexes.forEach(function(F){return x(F.name).add(n)});return i.mutate(p).then(function(F){return A&&(p.type==="add"||p.type==="put")&&(E.addKeys(F.results),v&&v.forEach(function(W){var U=p.values.map(function(N){return W.extractKey(N)}),z=W.keyPath.findIndex(function(N){return N===o.keyPath});F.results.forEach(function(N){return U[z]=N}),x(W.name).addKeys(U)})),y.mutatedParts=Pt(y.mutatedParts||{},b),F})}}),w=function(p){var y,b,x=p.query,E=x.index,k=x.range;return[E,new ee((y=k.lower)!==null&&y!==void 0?y:e.MIN_KEY,(b=k.upper)!==null&&b!==void 0?b:e.MAX_KEY)]},C={get:function(p){return[o,new ee(p.key)]},getMany:function(p){return[o,new ee().addKeys(p.keys)]},count:w,query:w,openCursor:w};return I(C).forEach(function(p){d[p]=function(y){var b=B.subscr,x=!!b,E=mr(B,i)&&gr(p,y),k=E?y.obsSet={}:b;if(x){var S=function(F){var W="idb://".concat(t,"/").concat(r,"/").concat(F);return k[W]||(k[W]=new ee)},R=S(""),A=S(":dels"),P=C[p](y),K=P[0],L=P[1];if(p==="query"&&K.isPrimaryKey&&!y.values?A.add(L):S(K.name||"").add(L),!K.isPrimaryKey)if(p==="count")A.add(n);else{var M=p==="query"&&l&&y.values&&i.query(g(g({},y),{values:!1}));return i[p].apply(this,arguments).then(function(F){if(p==="query"){if(l&&y.values)return M.then(function(N){var J=N.result;return R.addKeys(J),F});var W=y.values?F.result.map(c):F.result;y.values?R.addKeys(W):A.addKeys(W)}else if(p==="openCursor"){var U=F,z=y.values;return U&&Object.create(U,{key:{get:function(){return A.addKey(U.primaryKey),U.key}},primaryKey:{get:function(){var N=U.primaryKey;return A.addKey(N),N}},value:{get:function(){return z&&R.addKey(U.primaryKey),U.value}}})}return F})}}return i[p].apply(this,arguments)}}),d}})}};function Ui(e,t,n,r){function i(a){var o=e(a.name||"");function s(l){return l!=null?a.extractKey(l):null}var c=function(l){return a.multiEntry&&j(l)?l.forEach(function(v){return o.addKey(v)}):o.addKey(l)};(n||r).forEach(function(l,v){var d=n&&s(n[v]),w=r&&s(r[v]);q(d,w)!==0&&(d!=null&&c(d),w!=null&&c(w))})}t.indexes.forEach(i)}function wr(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;if(n.numFailures===r)return null;var i=g({},t);return j(i.keys)&&(i.keys=i.keys.filter(function(a,o){return!(o in n.failures)})),"values"in i&&j(i.values)&&(i.values=i.values.filter(function(a,o){return!(o in n.failures)})),i}function Wi(e,t){return t.lower===void 0?!0:t.lowerOpen?q(e,t.lower)>0:q(e,t.lower)>=0}function qi(e,t){return t.upper===void 0?!0:t.upperOpen?q(e,t.upper)<0:q(e,t.upper)<=0}function Cn(e,t){return Wi(e,t)&&qi(e,t)}function br(e,t,n,r,i,a){if(!n||n.length===0)return e;var o=t.query.index,s=o.multiEntry,c=t.query.range,l=r.schema.primaryKey,v=l.extractKey,d=o.extractKey,w=(o.lowLevelIndex||o).extractKey,C=n.reduce(function(p,y){var b=p,x=[];if(y.type==="add"||y.type==="put")for(var E=new ee,k=y.values.length-1;k>=0;--k){var S=y.values[k],R=v(S);if(!E.hasKey(R)){var A=d(S);(s&&j(A)?A.some(function(M){return Cn(M,c)}):Cn(A,c))&&(E.addKey(R),x.push(S))}}switch(y.type){case"add":b=p.concat(t.values?x:x.map(function(M){return v(M)}));break;case"put":var P=new ee().addKeys(y.values.map(function(M){return v(M)}));b=p.filter(function(M){return!P.hasKey(t.values?v(M):M)}).concat(t.values?x:x.map(function(M){return v(M)}));break;case"delete":var K=new ee().addKeys(y.keys);b=p.filter(function(M){return!K.hasKey(t.values?v(M):M)});break;case"deleteRange":var L=y.range;b=p.filter(function(M){return!Cn(v(M),L)});break}return b},e);return C===e?e:(C.sort(function(p,y){return q(w(p),w(y))||q(v(p),v(y))}),t.limit&&t.limit<1/0&&(C.length>t.limit?C.length=t.limit:e.length===t.limit&&C.length<t.limit&&(i.dirty=!0)),a?Object.freeze(C):C)}function _r(e,t){return q(e.lower,t.lower)===0&&q(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Vi(e,t,n,r){if(e===void 0)return t!==void 0?-1:0;if(t===void 0)return 1;var i=q(e,t);if(i===0){if(n&&r)return 0;if(n)return 1;if(r)return-1}return i}function zi(e,t,n,r){if(e===void 0)return t!==void 0?1:0;if(t===void 0)return-1;var i=q(e,t);if(i===0){if(n&&r)return 0;if(n)return-1;if(r)return 1}return i}function Hi(e,t){return Vi(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&zi(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function Gi(e,t,n,r){var i=Me["idb://".concat(e,"/").concat(t)];if(!i)return[];var a=i.queries[n];if(!a)return[null,!1,i,null];var o=r.query?r.query.index.name:null,s=a[o||""];if(!s)return[null,!1,i,null];switch(n){case"query":var c=s.find(function(d){return d.req.limit===r.limit&&d.req.values===r.values&&_r(d.req.query.range,r.query.range)});if(c)return[c,!0,i,s];var l=s.find(function(d){var w="limit"in d.req?d.req.limit:1/0;return w>=r.limit&&(r.values?d.req.values:!0)&&Hi(d.req.query.range,r.query.range)});return[l,!1,i,s];case"count":var v=s.find(function(d){return _r(d.req.query.range,r.query.range)});return[v,!!v,i,s]}}function Qi(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){e.subscribers.delete(n),e.subscribers.size===0&&Yi(e,t)})}function Yi(e,t){setTimeout(function(){e.subscribers.size===0&&Te(t,e)},3e3)}var Xi={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name,n=g(g({},e),{transaction:function(r,i,a){var o=e.transaction(r,i,a);if(i==="readwrite"){var s=new AbortController,c=s.signal,l=function(v){return function(){if(s.abort(),i==="readwrite"){for(var d=new Set,w=0,C=r;w<C.length;w++){var p=C[w],y=Me["idb://".concat(t,"/").concat(p)];if(y){var b=e.table(p),x=y.optimisticOps.filter(function(z){return z.trans===o});if(o._explicit&&v&&o.mutatedParts)for(var E=0,k=Object.values(y.queries.query);E<k.length;E++)for(var S=k[E],R=0,A=S.slice();R<A.length;R++){var P=A[R];bn(P.obsSet,o.mutatedParts)&&(Te(S,P),P.subscribers.forEach(function(z){return d.add(z)}))}else if(x.length>0){y.optimisticOps=y.optimisticOps.filter(function(z){return z.trans!==o});for(var K=0,L=Object.values(y.queries.query);K<L.length;K++)for(var S=L[K],M=0,F=S.slice();M<F.length;M++){var P=F[M];if(P.res!=null&&o.mutatedParts)if(v&&!P.dirty){var W=Object.isFrozen(P.res),U=br(P.res,P.req,x,b,P,W);P.dirty?(Te(S,P),P.subscribers.forEach(function(J){return d.add(J)})):U!==P.res&&(P.res=U,P.promise=O.resolve({result:U}))}else P.dirty&&Te(S,P),P.subscribers.forEach(function(J){return d.add(J)})}}}}d.forEach(function(z){return z()})}}};o.addEventListener("abort",l(!1),{signal:c}),o.addEventListener("error",l(!1),{signal:c}),o.addEventListener("complete",l(!0),{signal:c})}return o},table:function(r){var i=e.table(r),a=i.schema.primaryKey,o=g(g({},i),{mutate:function(s){var c=B.trans;if(a.outbound||c.db._options.cache==="disabled"||c.explicit)return i.mutate(s);var l=Me["idb://".concat(t,"/").concat(r)];if(!l)return i.mutate(s);var v=i.mutate(s);return(s.type==="add"||s.type==="put")&&(s.values.length>=50||Sn(a,s).some(function(d){return d==null}))?v.then(function(d){var w=g(g({},s),{values:s.values.map(function(p,y){var b,x=!((b=a.keyPath)===null||b===void 0)&&b.includes(".")?Ce(p):g({},p);return ne(x,a.keyPath,d.results[y]),x})}),C=wr(l,w,d);l.optimisticOps.push(C),queueMicrotask(function(){return s.mutatedParts&&Kt(s.mutatedParts)})}):(l.optimisticOps.push(s),s.mutatedParts&&Kt(s.mutatedParts),v.then(function(d){if(d.numFailures>0){Te(l.optimisticOps,s);var w=wr(l,s,d);w&&l.optimisticOps.push(w),s.mutatedParts&&Kt(s.mutatedParts)}}),v.catch(function(){Te(l.optimisticOps,s),s.mutatedParts&&Kt(s.mutatedParts)})),v},query:function(s){var c;if(!mr(B,i)||!gr("query",s))return i.query(s);var l=((c=B.trans)===null||c===void 0?void 0:c.db._options.cache)==="immutable",v=B,d=v.requery,w=v.signal,C=Gi(t,r,"query",s),p=C[0],y=C[1],b=C[2],x=C[3];if(p&&y)p.obsSet=s.obsSet;else{var E=i.query(s).then(function(k){var S=k.result;if(p&&(p.res=S),l){for(var R=0,A=S.length;R<A;++R)Object.freeze(S[R]);Object.freeze(S)}else k.result=Ce(S);return k}).catch(function(k){return x&&p&&Te(x,p),Promise.reject(k)});p={obsSet:s.obsSet,promise:E,subscribers:new Set,type:"query",req:s,dirty:!1},x?x.push(p):(x=[p],b||(b=Me["idb://".concat(t,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),b.queries.query[s.query.index.name||""]=x)}return Qi(p,x,d,w),p.promise.then(function(k){return{result:br(k.result,s,b==null?void 0:b.optimisticOps,i,p,l)}})}});return o}});return n}};function Mt(e,t){return new Proxy(e,{get:function(n,r,i){return r==="db"?t:Reflect.get(n,r,i)}})}var ve=function(){function e(t,n){var r=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=n=g({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:V,dbReadyPromise:null,cancelOpen:V,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};o.dbReadyPromise=new O(function(c){o.dbReadyResolve=c}),o.openCanceller=new O(function(c,l){o.cancelOpen=l}),this._state=o,this.name=t,this.on=et(this,"populate","blocked","versionchange","close",{ready:[qt,V]}),this.on.ready.subscribe=Pn(this.on.ready.subscribe,function(c){return function(l,v){e.vip(function(){var d=r._state;if(d.openComplete)d.dbOpenError||O.resolve().then(l),v&&c(l);else if(d.onReadyBeingFired)d.onReadyBeingFired.push(l),v&&c(l);else{c(l);var w=r;v||c(function C(){w.on.ready.unsubscribe(l),w.on.ready.unsubscribe(C)})}})}}),this.Collection=ai(this),this.Table=ti(this),this.Transaction=di(this),this.Version=Ai(this),this.WhereClause=fi(this),this.on("versionchange",function(c){c.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(r.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(r.name,"'. Closing db now to resume the delete request.")),r.close({disableAutoOpen:!1})}),this.on("blocked",function(c){!c.newVersion||c.newVersion<c.oldVersion?console.warn("Dexie.delete('".concat(r.name,"') was blocked")):console.warn("Upgrade '".concat(r.name,"' blocked by other connection holding version ").concat(c.oldVersion/10))}),this._maxKey=at(n.IDBKeyRange),this._createTransaction=function(c,l,v,d){return new r.Transaction(c,l,v,r._options.chromeTransactionDurability,d)},this._fireOnBlocked=function(c){r.on("blocked").fire(c),qe.filter(function(l){return l.name===r.name&&l!==r&&!l._state.vcFired}).map(function(l){return l.on("versionchange").fire(c)})},this.use(Li),this.use(Xi),this.use(ji),this.use($i),this.use(Fi);var s=new Proxy(this,{get:function(c,l,v){if(l==="_vip")return!0;if(l==="table")return function(w){return Mt(r.table(w),s)};var d=Reflect.get(c,l,v);return d instanceof nr?Mt(d,s):l==="tables"?d.map(function(w){return Mt(w,s)}):l==="_createTransaction"?function(){var w=d.apply(this,arguments);return Mt(w,s)}:d}});this.vip=s,a.forEach(function(c){return c(r)})}return e.prototype.version=function(t){if(isNaN(t)||t<.1)throw new $.Type("Given version is not a positive number");if(t=Math.round(t*10)/10,this.idbdb||this._state.isBeingOpened)throw new $.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var n=this._versions,r=n.filter(function(i){return i._cfg.version===t})[0];return r||(r=new this.Version(t),n.push(r),n.sort(bi),r.stores({}),this._state.autoSchema=!1,r)},e.prototype._whenReady=function(t){var n=this;return this.idbdb&&(this._state.openComplete||B.letThrough||this._vip)?t():new O(function(r,i){if(n._state.openComplete)return i(new $.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._state.autoOpen){i(new $.DatabaseClosed);return}n.open().catch(V)}n._state.dbReadyPromise.then(r,i)}).then(t)},e.prototype.use=function(t){var n=t.stack,r=t.create,i=t.level,a=t.name;a&&this.unuse({stack:n,name:a});var o=this._middlewares[n]||(this._middlewares[n]=[]);return o.push({stack:n,create:r,level:i??10,name:a}),o.sort(function(s,c){return s.level-c.level}),this},e.prototype.unuse=function(t){var n=t.stack,r=t.name,i=t.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},e.prototype.open=function(){var t=this;return Pe(me,function(){return Ii(t)})},e.prototype._close=function(){var t=this._state,n=qe.indexOf(this);if(n>=0&&qe.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}t.isBeingOpened||(t.dbReadyPromise=new O(function(r){t.dbReadyResolve=r}),t.openCanceller=new O(function(r,i){t.cancelOpen=i}))},e.prototype.close=function(t){var n=t===void 0?{disableAutoOpen:!0}:t,r=n.disableAutoOpen,i=this._state;r?(i.isBeingOpened&&i.cancelOpen(new $.DatabaseClosed),this._close(),i.autoOpen=!1,i.dbOpenError=new $.DatabaseClosed):(this._close(),i.autoOpen=this._options.autoOpen||i.isBeingOpened,i.openComplete=!1,i.dbOpenError=null)},e.prototype.delete=function(t){var n=this;t===void 0&&(t={disableAutoOpen:!0});var r=arguments.length>0&&typeof arguments[0]!="object",i=this._state;return new O(function(a,o){var s=function(){n.close(t);var c=n._deps.indexedDB.deleteDatabase(n.name);c.onsuccess=G(function(){Pi(n._deps,n.name),a()}),c.onerror=ue(o),c.onblocked=n._fireOnBlocked};if(r)throw new $.InvalidArgument("Invalid closeOptions argument to db.delete()");i.isBeingOpened?i.dbReadyPromise.then(s):s()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return this.idbdb!==null},e.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"},e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var t=this;return I(this._allTables).map(function(n){return t._allTables[n]})},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var t=Mi.apply(this,arguments);return this._transaction.apply(this,t)},e.prototype._transaction=function(t,n,r){var i=this,a=B.trans;(!a||a.db!==this||t.indexOf("!")!==-1)&&(a=null);var o=t.indexOf("?")!==-1;t=t.replace("!","").replace("?","");var s,c;try{if(c=n.map(function(v){var d=v instanceof i.Table?v.name:v;if(typeof d!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return d}),t=="r"||t===nn)s=nn;else if(t=="rw"||t==rn)s=rn;else throw new $.InvalidArgument("Invalid transaction mode: "+t);if(a){if(a.mode===nn&&s===rn)if(o)a=null;else throw new $.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&c.forEach(function(v){if(a&&a.storeNames.indexOf(v)===-1)if(o)a=null;else throw new $.SubTransaction("Table "+v+" not included in parent transaction.")}),o&&a&&!a.active&&(a=null)}}catch(v){return a?a._promise(null,function(d,w){w(v)}):Y(v)}var l=vr.bind(null,this,s,c,a,r);return a?a._promise(s,l,"lock"):B.trans?Pe(B.transless,function(){return i._whenReady(l)}):this._whenReady(l)},e.prototype.table=function(t){if(!H(this._allTables,t))throw new $.InvalidTable("Table ".concat(t," does not exist"));return this._allTables[t]},e}(),Ji=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Zi=function(){function e(t){this._subscribe=t}return e.prototype.subscribe=function(t,n,r){return this._subscribe(!t||typeof t=="function"?{next:t,error:n,complete:r}:t)},e.prototype[Ji]=function(){return this},e}(),Bt;try{Bt={indexedDB:T.indexedDB||T.mozIndexedDB||T.webkitIndexedDB||T.msIndexedDB,IDBKeyRange:T.IDBKeyRange||T.webkitIDBKeyRange}}catch{Bt={indexedDB:null,IDBKeyRange:null}}function xr(e){var t=!1,n,r=new Zi(function(i){var a=jt(e);function o(x){var E=je();try{a&&We();var k=ge(e,x);return a&&(k=k.finally(we)),k}finally{E&&Ue()}}var s=!1,c,l={},v={},d={get closed(){return s},unsubscribe:function(){s||(s=!0,c&&c.abort(),w&&xe.storagemutated.unsubscribe(y))}};i.start&&i.start(d);var w=!1,C=function(){return Zt(b)};function p(){return bn(v,l)}var y=function(x){Pt(l,x),p()&&C()},b=function(){if(!(s||!Bt.indexedDB)){l={};var x={};c&&c.abort(),c=new AbortController;var E={subscr:x,signal:c.signal,requery:C,querier:e,trans:null},k=o(E);Promise.resolve(k).then(function(S){t=!0,n=S,!(s||E.signal.aborted)&&(l={},v=x,!Ar(v)&&!w&&(xe(it,y),w=!0),Zt(function(){return!s&&i.next&&i.next(S)}))},function(S){t=!1,["DatabaseClosedError","AbortError"].includes(S==null?void 0:S.name)||s||Zt(function(){s||i.error&&i.error(S)})})}};return setTimeout(C,0),d});return r.hasValue=function(){return t},r.getValue=function(){return n},r}var Be=ve;fe(Be,g(g({},ht),{delete:function(e){var t=new Be(e,{addons:[]});return t.delete()},exists:function(e){return new Be(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return Di(Be.dependencies).then(e)}catch{return Y(new $.MissingAPI)}},defineClass:function(){function e(t){Q(this,t)}return e},ignoreTransaction:function(e){return B.trans?Pe(B.transless,e):e()},vip:mn,async:function(e){return function(){try{var t=Rn(e.apply(this,arguments));return!t||typeof t.then!="function"?O.resolve(t):t}catch(n){return Y(n)}}},spawn:function(e,t,n){try{var r=Rn(e.apply(n,t||[]));return!r||typeof r.then!="function"?O.resolve(r):r}catch(i){return Y(i)}},currentTransaction:{get:function(){return B.trans||null}},waitFor:function(e,t){var n=O.resolve(typeof e=="function"?Be.ignoreTransaction(e):e).timeout(t||6e4);return B.trans?B.trans.waitFor(n):n},Promise:O,debug:{get:function(){return se},set:function(e){jn(e)}},derive:$e,extend:Q,props:fe,override:Pn,Events:et,on:xe,liveQuery:xr,extendObservabilitySet:Pt,getByKeyPath:he,setByKeyPath:ne,delByKeyPath:Sr,shallowClone:In,deepClone:Ce,getObjectDiff:kn,cmp:q,asap:Kn,minKey:tn,addons:[],connections:qe,errnames:Wt,dependencies:Bt,cache:Me,semVer:Yn,version:Yn.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,n*2)})})),Be.maxKey=at(Be.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(xe(it,function(e){if(!Ee){var t;t=new CustomEvent(un,{detail:e}),Ee=!0,dispatchEvent(t),Ee=!1}}),addEventListener(un,function(e){var t=e.detail;Ee||Tn(t)}));function Tn(e){var t=Ee;try{Ee=!0,xe.storagemutated.fire(e),En(e,!0)}finally{Ee=t}}var Ee=!1,Re,An=function(){};typeof BroadcastChannel<"u"&&(An=function(){Re=new BroadcastChannel(un),Re.onmessage=function(e){return e.data&&Tn(e.data)}},An(),typeof Re.unref=="function"&&Re.unref(),xe(it,function(e){Ee||Re.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!ve.disableBfCache&&e.persisted){se&&console.debug("Dexie: handling persisted pagehide"),Re==null||Re.close();for(var t=0,n=qe;t<n.length;t++){var r=n[t];r.close({disableAutoOpen:!1})}}}),addEventListener("pageshow",function(e){!ve.disableBfCache&&e.persisted&&(se&&console.debug("Dexie: handling persisted pageshow"),An(),Tn({all:new ee(-1/0,[[]])}))}));function ea(e){return new nt({add:e})}function ta(e){return new nt({remove:e})}function na(e,t){return new nt({replacePrefix:[e,t]})}O.rejectionMapper=Mr,jn(se);var ra=Object.freeze({__proto__:null,Dexie:ve,liveQuery:xr,Entity:Zn,cmp:q,PropModSymbol:ri,PropModification:nt,replacePrefix:na,add:ea,remove:ta,default:ve,RangeSet:ee,mergeRanges:ut,rangesOverlap:fr});return g(ve,ra,{default:ve}),ve})})(dexie);var dexieExports=dexie.exports;const _Dexie=getDefaultExportFromCjs(dexieExports),DexieSymbol=Symbol.for("Dexie"),Dexie=globalThis[DexieSymbol]||(globalThis[DexieSymbol]=_Dexie);if(_Dexie.semVer!==Dexie.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${_Dexie.semVer} and ${Dexie.semVer}`);class QspiderDatabase extends Dexie{constructor(){super("QspiderDatabase"),this.version(2).stores({games:"id, title",gameResources:"++, game_id, &[game_id+path]",gameSaves:"++, game_id, &[game_id+key+slot], slot, [game_id+slot], [game_id+key]"})}}class WebStorage{constructor(){this.db=new QspiderDatabase}async prepareLoadConfig(u,h){return{url:`/qspider-files/${u}/`,entrypoint:h}}async getGames(){return(await this.db.games.toArray()).reduce((h,m)=>(h[m.id]=m,h),{})}async addGame(u,h){await this.db.games.put(h,u)}async updateGame(u,h){await this.db.games.update(u,h)}async removeGame(u){await this.db.transaction("rw",this.db.games,this.db.gameResources,async()=>{await this.db.games.delete(u),await this.db.gameResources.where("game_id").equals(u).delete()})}async addGameResource(u,h,m){const g=h.toLowerCase();await this.db.gameResources.where({game_id:u,path:g}).delete(),await this.db.gameResources.put({game_id:u,path:g,content:m})}async getGameResource(u,h){const m=h.toLowerCase(),g=await this.db.gameResources.where({game_id:u,path:m}).first();return(g==null?void 0:g.content)||null}async saveByKey(u,h,m){await this.db.gameSaves.where({game_id:u,key:h,slot:-1}).delete();const g={timestamp:Date.now(),game_id:u,key:h,slot:-1,data:m};await this.db.gameSaves.put(g)}async saveBySlot(u,h,m){await this.db.gameSaves.where({game_id:u,key:"",slot:h}).delete();const g={timestamp:Date.now(),game_id:u,key:"",slot:h,data:m};await this.db.gameSaves.put(g)}async hasSaveByKey(u,h){return await this.db.gameSaves.where({game_id:u,key:h}).count()>0}async hasSaveBySlot(u,h){return await this.db.gameSaves.where({game_id:u,slot:h}).count()>0}async getSaveDataByKey(u,h){const m=await this.db.gameSaves.where({game_id:u,key:h}).first();return(m==null?void 0:m.data)||null}async getSaveDataBySlot(u,h){const m=await this.db.gameSaves.where({game_id:u,slot:h}).first();return(m==null?void 0:m.data)||null}async getSavedSlots(u){return await this.db.gameSaves.where({game_id:u}).and(h=>h.slot>0).toArray()}async getNamedSaves(u){return await this.db.gameSaves.where({game_id:u}).and(h=>h.key!=="").toArray()}async clearSaveSlot(u,h){await this.db.gameSaves.where({game_id:u,key:"",slot:h}).delete()}async clearSaveKey(u,h){await this.db.gameSaves.where({game_id:u,key:h,slot:-1}).delete()}}let instance=null;function getStorage(){return instance||(instance=new WebStorage),instance}typeof window<"u"&&typeof window.global>"u"&&(window.global=window);class TomlError extends Error{constructor(u){super(u),this.name="TomlError",Error.captureStackTrace&&Error.captureStackTrace(this,TomlError),this.fromTOML=!0,this.wrapped=null}}TomlError.wrap=f=>{const u=new TomlError(f.message);return u.code=f.code,u.wrapped=f,u};let _custom;try{const utilInspect=eval("require('util').inspect");_custom=utilInspect.custom}catch(f){}try{self["workbox:strategies:7.0.0"]&&_()}catch(f){}function toRequest(f){return typeof f=="string"?new Request(f):f}class StrategyHandler{constructor(u,h){this._cacheKeys={},finalAssertExports.isInstance(h.event,ExtendableEvent,{moduleName:"workbox-strategies",className:"StrategyHandler",funcName:"constructor",paramName:"options.event"}),Object.assign(this,h),this.event=h.event,this._strategy=u,this._handlerDeferred=new Deferred,this._extendLifetimePromises=[],this._plugins=[...u.plugins],this._pluginStateMap=new Map;for(const m of this._plugins)this._pluginStateMap.set(m,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(u){const{event:h}=this;let m=toRequest(u);if(m.mode==="navigate"&&h instanceof FetchEvent&&h.preloadResponse){const T=await h.preloadResponse;if(T)return logger.log(`Using a preloaded navigation response for '${getFriendlyURL(m.url)}'`),T}const g=this.hasCallback("fetchDidFail")?m.clone():null;try{for(const T of this.iterateCallbacks("requestWillFetch"))m=await T({request:m.clone(),event:h})}catch(T){if(T instanceof Error)throw new WorkboxError("plugin-error-request-will-fetch",{thrownErrorMessage:T.message})}const D=m.clone();try{let T;T=await fetch(m,m.mode==="navigate"?void 0:this._strategy.fetchOptions),logger.debug(`Network request for '${getFriendlyURL(m.url)}' returned a response with status '${T.status}'.`);for(const I of this.iterateCallbacks("fetchDidSucceed"))T=await I({event:h,request:D,response:T});return T}catch(T){throw logger.log(`Network request for '${getFriendlyURL(m.url)}' threw an error.`,T),g&&await this.runCallbacks("fetchDidFail",{error:T,event:h,originalRequest:g.clone(),request:D.clone()}),T}}async fetchAndCachePut(u){const h=await this.fetch(u),m=h.clone();return this.waitUntil(this.cachePut(u,m)),h}async cacheMatch(u){const h=toRequest(u);let m;const{cacheName:g,matchOptions:D}=this._strategy,T=await this.getCacheKey(h,"read"),I=Object.assign(Object.assign({},D),{cacheName:g});m=await caches.match(T,I),m?logger.debug(`Found a cached response in '${g}'.`):logger.debug(`No cached response found in '${g}'.`);for(const j of this.iterateCallbacks("cachedResponseWillBeUsed"))m=await j({cacheName:g,matchOptions:D,cachedResponse:m,request:T,event:this.event})||void 0;return m}async cachePut(u,h){const m=toRequest(u);await timeout(0);const g=await this.getCacheKey(m,"write");{if(g.method&&g.method!=="GET")throw new WorkboxError("attempt-to-cache-non-get-request",{url:getFriendlyURL(g.url),method:g.method});const te=h.headers.get("Vary");te&&logger.debug(`The response for ${getFriendlyURL(g.url)} has a 'Vary: ${te}' header. Consider setting the {ignoreVary: true} option on your strategy to ensure cache matching and deletion works as expected.`)}if(!h)throw logger.error(`Cannot cache non-existent response for '${getFriendlyURL(g.url)}'.`),new WorkboxError("cache-put-with-no-response",{url:getFriendlyURL(g.url)});const D=await this._ensureResponseSafeToCache(h);if(!D)return logger.debug(`Response '${getFriendlyURL(g.url)}' will not be cached.`,D),!1;const{cacheName:T,matchOptions:I}=this._strategy,j=await self.caches.open(T),Q=this.hasCallback("cacheDidUpdate"),Z=Q?await cacheMatchIgnoreParams(j,g.clone(),["__WB_REVISION__"],I):null;logger.debug(`Updating the '${T}' cache with a new Response for ${getFriendlyURL(g.url)}.`);try{await j.put(g,Q?D.clone():D)}catch(te){if(te instanceof Error)throw te.name==="QuotaExceededError"&&await executeQuotaErrorCallbacks(),te}for(const te of this.iterateCallbacks("cacheDidUpdate"))await te({cacheName:T,oldResponse:Z,newResponse:D.clone(),request:g,event:this.event});return!0}async getCacheKey(u,h){const m=`${u.url} | ${h}`;if(!this._cacheKeys[m]){let g=u;for(const D of this.iterateCallbacks("cacheKeyWillBeUsed"))g=toRequest(await D({mode:h,request:g,event:this.event,params:this.params}));this._cacheKeys[m]=g}return this._cacheKeys[m]}hasCallback(u){for(const h of this._strategy.plugins)if(u in h)return!0;return!1}async runCallbacks(u,h){for(const m of this.iterateCallbacks(u))await m(h)}*iterateCallbacks(u){for(const h of this._strategy.plugins)if(typeof h[u]=="function"){const m=this._pluginStateMap.get(h);yield D=>{const T=Object.assign(Object.assign({},D),{state:m});return h[u](T)}}}waitUntil(u){return this._extendLifetimePromises.push(u),u}async doneWaiting(){let u;for(;u=this._extendLifetimePromises.shift();)await u}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(u){let h=u,m=!1;for(const g of this.iterateCallbacks("cacheWillUpdate"))if(h=await g({request:this.request,response:h,event:this.event})||void 0,m=!0,!h)break;return m||(h&&h.status!==200&&(h=void 0),h&&h.status!==200&&(h.status===0?logger.warn(`The response for '${this.request.url}' is an opaque response. The caching strategy that you're using will not cache opaque responses by default.`):logger.debug(`The response for '${this.request.url}' returned a status code of '${u.status}' and won't be cached as a result.`))),h}}class Strategy{constructor(u={}){this.cacheName=cacheNames.getRuntimeName(u.cacheName),this.plugins=u.plugins||[],this.fetchOptions=u.fetchOptions,this.matchOptions=u.matchOptions}handle(u){const[h]=this.handleAll(u);return h}handleAll(u){u instanceof FetchEvent&&(u={event:u,request:u.request});const h=u.event,m=typeof u.request=="string"?new Request(u.request):u.request,g="params"in u?u.params:void 0,D=new StrategyHandler(this,{event:h,request:m,params:g}),T=this._getResponse(D,m,h),I=this._awaitComplete(T,D,m,h);return[T,I]}async _getResponse(u,h,m){await u.runCallbacks("handlerWillStart",{event:m,request:h});let g;try{if(g=await this._handle(h,u),!g||g.type==="error")throw new WorkboxError("no-response",{url:h.url})}catch(D){if(D instanceof Error){for(const T of u.iterateCallbacks("handlerDidError"))if(g=await T({error:D,event:m,request:h}),g)break}if(g)logger.log(`While responding to '${getFriendlyURL(h.url)}', an ${D instanceof Error?D.toString():""} error occurred. Using a fallback response provided by a handlerDidError plugin.`);else throw D}for(const D of u.iterateCallbacks("handlerWillRespond"))g=await D({event:m,request:h,response:g});return g}async _awaitComplete(u,h,m,g){let D,T;try{D=await u}catch{}try{await h.runCallbacks("handlerDidRespond",{event:g,request:m,response:D}),await h.doneWaiting()}catch(I){I instanceof Error&&(T=I)}if(await h.runCallbacks("handlerDidComplete",{event:g,request:m,response:D,error:T}),h.destroy(),T)throw T}}const messages={strategyStart:(f,u)=>`Using ${f} to respond to '${getFriendlyURL(u.url)}'`,printFinalResponse:f=>{f&&(logger.groupCollapsed("View the final response here."),logger.log(f||"[No response returned]"),logger.groupEnd())}};class NetworkOnly extends Strategy{constructor(u={}){super(u),this._networkTimeoutSeconds=u.networkTimeoutSeconds||0}async _handle(u,h){finalAssertExports.isInstance(u,Request,{moduleName:"workbox-strategies",className:this.constructor.name,funcName:"_handle",paramName:"request"});let m,g;try{const D=[h.fetch(u)];if(this._networkTimeoutSeconds){const T=timeout(this._networkTimeoutSeconds*1e3);D.push(T)}if(g=await Promise.race(D),!g)throw new Error(`Timed out the network response after ${this._networkTimeoutSeconds} seconds.`)}catch(D){D instanceof Error&&(m=D)}if(logger.groupCollapsed(messages.strategyStart(this.constructor.name,u)),g?logger.log("Got response from network."):logger.log("Unable to get a response from the network."),messages.printFinalResponse(g),logger.groupEnd(),!g)throw new WorkboxError("no-response",{url:u.url,error:m});return g}}try{self["workbox:routing:7.0.0"]&&_()}catch(f){}const defaultMethod="GET",validMethods=["DELETE","GET","HEAD","PATCH","POST","PUT"],normalizeHandler=f=>f&&typeof f=="object"?(finalAssertExports.hasMethod(f,"handle",{moduleName:"workbox-routing",className:"Route",funcName:"constructor",paramName:"handler"}),f):(finalAssertExports.isType(f,"function",{moduleName:"workbox-routing",className:"Route",funcName:"constructor",paramName:"handler"}),{handle:f});class Route{constructor(u,h,m=defaultMethod){finalAssertExports.isType(u,"function",{moduleName:"workbox-routing",className:"Route",funcName:"constructor",paramName:"match"}),m&&finalAssertExports.isOneOf(m,validMethods,{paramName:"method"}),this.handler=normalizeHandler(h),this.match=u,this.method=m}setCatchHandler(u){this.catchHandler=normalizeHandler(u)}}class RegExpRoute extends Route{constructor(u,h,m){finalAssertExports.isInstance(u,RegExp,{moduleName:"workbox-routing",className:"RegExpRoute",funcName:"constructor",paramName:"pattern"});const g=({url:D})=>{const T=u.exec(D.href);if(T){if(D.origin!==location.origin&&T.index!==0){logger.debug(`The regular expression '${u.toString()}' only partially matched against the cross-origin URL '${D.toString()}'. RegExpRoute's will only handle cross-origin requests if they match the entire URL.`);return}return T.slice(1)}};super(g,h,m)}}class Router{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",u=>{const{request:h}=u,m=this.handleRequest({request:h,event:u});m&&u.respondWith(m)})}addCacheListener(){self.addEventListener("message",u=>{if(u.data&&u.data.type==="CACHE_URLS"){const{payload:h}=u.data;logger.debug("Caching URLs from the window",h.urlsToCache);const m=Promise.all(h.urlsToCache.map(g=>{typeof g=="string"&&(g=[g]);const D=new Request(...g);return this.handleRequest({request:D,event:u})}));u.waitUntil(m),u.ports&&u.ports[0]&&m.then(()=>u.ports[0].postMessage(!0))}})}handleRequest({request:u,event:h}){finalAssertExports.isInstance(u,Request,{moduleName:"workbox-routing",className:"Router",funcName:"handleRequest",paramName:"options.request"});const m=new URL(u.url,location.href);if(!m.protocol.startsWith("http")){logger.debug("Workbox Router only supports URLs that start with 'http'.");return}const g=m.origin===location.origin,{params:D,route:T}=this.findMatchingRoute({event:h,request:u,sameOrigin:g,url:m});let I=T&&T.handler;const j=[];I&&(j.push(["Found a route to handle this request:",T]),D&&j.push(["Passing the following params to the route's handler:",D]));const Q=u.method;if(!I&&this._defaultHandlerMap.has(Q)&&(j.push(`Failed to find a matching route. Falling back to the default handler for ${Q}.`),I=this._defaultHandlerMap.get(Q)),!I){logger.debug(`No route found for: ${getFriendlyURL(m)}`);return}logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(m)}`),j.forEach(H=>{Array.isArray(H)?logger.log(...H):logger.log(H)}),logger.groupEnd();let Z;try{Z=I.handle({url:m,request:u,event:h,params:D})}catch(H){Z=Promise.reject(H)}const te=T&&T.catchHandler;return Z instanceof Promise&&(this._catchHandler||te)&&(Z=Z.catch(async H=>{if(te){logger.groupCollapsed(`Error thrown when responding to:  ${getFriendlyURL(m)}. Falling back to route's Catch Handler.`),logger.error("Error thrown by:",T),logger.error(H),logger.groupEnd();try{return await te.handle({url:m,request:u,event:h,params:D})}catch(fe){fe instanceof Error&&(H=fe)}}if(this._catchHandler)return logger.groupCollapsed(`Error thrown when responding to:  ${getFriendlyURL(m)}. Falling back to global Catch Handler.`),logger.error("Error thrown by:",T),logger.error(H),logger.groupEnd(),this._catchHandler.handle({url:m,request:u,event:h});throw H})),Z}findMatchingRoute({url:u,sameOrigin:h,request:m,event:g}){const D=this._routes.get(m.method)||[];for(const T of D){let I;const j=T.match({url:u,sameOrigin:h,request:m,event:g});if(j)return j instanceof Promise&&logger.warn(`While routing ${getFriendlyURL(u)}, an async matchCallback function was used. Please convert the following route to use a synchronous matchCallback function:`,T),I=j,(Array.isArray(I)&&I.length===0||j.constructor===Object&&Object.keys(j).length===0||typeof j=="boolean")&&(I=void 0),{route:T,params:I}}return{}}setDefaultHandler(u,h=defaultMethod){this._defaultHandlerMap.set(h,normalizeHandler(u))}setCatchHandler(u){this._catchHandler=normalizeHandler(u)}registerRoute(u){finalAssertExports.isType(u,"object",{moduleName:"workbox-routing",className:"Router",funcName:"registerRoute",paramName:"route"}),finalAssertExports.hasMethod(u,"match",{moduleName:"workbox-routing",className:"Router",funcName:"registerRoute",paramName:"route"}),finalAssertExports.isType(u.handler,"object",{moduleName:"workbox-routing",className:"Router",funcName:"registerRoute",paramName:"route"}),finalAssertExports.hasMethod(u.handler,"handle",{moduleName:"workbox-routing",className:"Router",funcName:"registerRoute",paramName:"route.handler"}),finalAssertExports.isType(u.method,"string",{moduleName:"workbox-routing",className:"Router",funcName:"registerRoute",paramName:"route.method"}),this._routes.has(u.method)||this._routes.set(u.method,[]),this._routes.get(u.method).push(u)}unregisterRoute(u){if(!this._routes.has(u.method))throw new WorkboxError("unregister-route-but-not-found-with-method",{method:u.method});const h=this._routes.get(u.method).indexOf(u);if(h>-1)this._routes.get(u.method).splice(h,1);else throw new WorkboxError("unregister-route-route-not-registered")}}let defaultRouter;const getOrCreateDefaultRouter=()=>(defaultRouter||(defaultRouter=new Router,defaultRouter.addFetchListener(),defaultRouter.addCacheListener()),defaultRouter);function registerRoute(f,u,h){let m;if(typeof f=="string"){const D=new URL(f,location.href);{if(!(f.startsWith("/")||f.startsWith("http")))throw new WorkboxError("invalid-string",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});const I=f.startsWith("http")?D.pathname:f,j="[*:?+]";new RegExp(`${j}`).exec(I)&&logger.debug(`The '$capture' parameter contains an Express-style wildcard character (${j}). Strings are now always interpreted as exact matches; use a RegExp for partial or wildcard matches.`)}const T=({url:I})=>(I.pathname===D.pathname&&I.origin!==D.origin&&logger.debug(`${f} only partially matches the cross-origin URL ${I.toString()}. This route will only handle cross-origin requests if they match the entire URL.`),I.href===D.href);m=new Route(T,u,h)}else if(f instanceof RegExp)m=new RegExpRoute(f,u,h);else if(typeof f=="function")m=new Route(f,u,h);else if(f instanceof Route)m=f;else throw new WorkboxError("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return getOrCreateDefaultRouter().registerRoute(m),m}const sw=self,storage=getStorage();clientsClaim();sw.addEventListener("install",()=>{sw.skipWaiting()});const regexp=/\/qspider-files\/(.*?)\/(.*)/i;class QspiderStrategy extends Strategy{async _handle(u,h){const m=u.url.match(regexp);if(m){const[,g,D]=m,T=await storage.getGameResource(decodeURI(g),decodeURI(D));if(T){const I=new Uint8Array(T.slice(0,2));if(D.endsWith(".xml")&&I[0]===255&&I[1]===254){const Q=new TextDecoder("utf-16le").decode(T);return new Response(Q)}return new Response(T)}else return new Response(null,{status:404})}return await h.fetch(u)}}registerRoute(({request:f})=>f.url.includes("/qspider-files/"),new QspiderStrategy);const networkOnlyNavigationRoute=new Route(({request:f})=>f.mode==="navigate",new NetworkOnly);registerRoute(networkOnlyNavigationRoute);
